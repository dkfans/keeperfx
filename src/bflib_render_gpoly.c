/******************************************************************************/
// Bullfrog Engine Emulation Library - for use to remake classic games like
// Syndicate Wars, Magic Carpet or Dungeon Keeper.
/******************************************************************************/
/** @file bflib_render_gpoly.c
 *     Rendering function draw_gpoly() for drawing 3D view elements.
 * @par Purpose:
 *     Function for rendering 3D elements.
 * @par Comment:
 *     Go away from here, you bad optimizer! Do not compile this with optimizations.
 * @author   Tomasz Lis
 * @date     20 Mar 2009 - 14 Feb 2010
 * @par  Copying and copyrights:
 *     This program is free software; you can redistribute it and/or modify
 *     it under the terms of the GNU General Public License as published by
 *     the Free Software Foundation; either version 2 of the License, or
 *     (at your option) any later version.
 */
/******************************************************************************/
#include "pre_inc.h"
#include "bflib_render.h"

#include "globals.h"
#include "bflib_basics.h"
#include "bflib_video.h"
#include "bflib_sprite.h"
#include "bflib_vidraw.h"
#include "post_inc.h"

/******************************************************************************/
/******************************************************************************/
long gpoly_countdown[] = { 0,-15,-14,-13,-12,-11,-10, -9,  -8, -7, -6, -5, -4, -3, -2, -1 };

long gpoly_reptable[] = {
         0x0,0x7FFFFFFF,0x3FFFFFFF,0x2AAAAAAA,0x1FFFFFFF,0x19999999,0x15555555,0x12492492,
  0x0FFFFFFF,0x0E38E38E,0x0CCCCCCC,0x0BA2E8BA,0x0AAAAAAA, 0x9D89D89, 0x9249249, 0x8888888,
   0x7FFFFFF, 0x7878787, 0x71C71C7, 0x6BCA1AF, 0x6666666, 0x6186186, 0x5D1745D, 0x590B216,
   0x5555555, 0x51EB851, 0x4EC4EC4, 0x4BDA12F, 0x4924924, 0x469EE58, 0x4444444, 0x4210842,
   0x3FFFFFF, 0x3E0F83E, 0x3C3C3C3, 0x3A83A83, 0x38E38E3, 0x3759F22, 0x35E50D7, 0x3483483,
   0x3333333, 0x31F3831, 0x30C30C3, 0x2FA0BE8, 0x2E8BA2E, 0x2D82D82, 0x2C8590B, 0x2B93105,
   0x2AAAAAA, 0x29CBC14, 0x28F5C28, 0x2828282, 0x2762762, 0x26A439F, 0x25ED097, 0x253C825,
   0x2492492, 0x23EE08F, 0x234F72C, 0x22B63CB, 0x2222222, 0x2192E29, 0x2108421, 0x2082082,
   0x1FFFFFF, 0x1F81F81, 0x1F07C1F, 0x1E9131A, 0x1E1E1E1, 0x1DAE607, 0x1D41D41, 0x1CD8568,
   0x1C71C71, 0x1C0E070, 0x1BACF91, 0x1B4E81B, 0x1AF286B, 0x1A98EF6, 0x1A41A41, 0x19EC8E9,
   0x1999999, 0x1948B0F, 0x18F9C18, 0x18ACB90, 0x1861861, 0x1818181, 0x17D05F4, 0x178A4C8,
   0x1745D17, 0x1702E05, 0x16C16C1, 0x1681681, 0x1642C85, 0x1605816, 0x15C9882, 0x158ED23,
   0x1555555, 0x151D07E, 0x14E5E0A, 0x14AFD6A, 0x147AE14, 0x1446F86, 0x1414141, 0x13E22CB,
   0x13B13B1, 0x1381381, 0x13521CF, 0x1323E34, 0x12F684B, 0x12C9FB4, 0x129E412, 0x127350B,
   0x1249249, 0x121FB78, 0x11F7047, 0x11CF06A, 0x11A7B96, 0x1181181, 0x115B1E5, 0x1135C81,
   0x1111111, 0x10ECF56, 0x10C9714, 0x10A6810, 0x1084210, 0x10624DD, 0x1041041, 0x1020408,
   0x0FFFFFF, 0x0FE03F8, 0x0FC0FC0, 0x0FA232C, 0x0F83E0F, 0x0F6603D, 0x0F4898D, 0x0F2B9D6,
   0x0F0F0F0, 0x0EF2EB7, 0x0ED7303, 0x0EBBDB2, 0x0EA0EA0, 0x0E865AC, 0x0E6C2B4, 0x0E52598,
   0x0E38E38, 0x0E1FC78, 0x0E07038, 0x0DEE95C, 0x0DD67C8, 0x0DBEB61, 0x0DA740D, 0x0D901B2,
   0x0D79435, 0x0D62B80, 0x0D4C77B, 0x0D3680D, 0x0D20D20, 0x0D0B69F, 0x0CF6474, 0x0CE168A,
   0x0CCCCCC, 0x0CB8727, 0x0CA4587, 0x0C907DA, 0x0C7CE0C, 0x0C6980C, 0x0C565C8, 0x0C4372F,
   0x0C30C30, 0x0C1E4BB, 0x0C0C0C0, 0x0BFA02F, 0x0BE82FA, 0x0BD6910, 0x0BC5264, 0x0BB3EE7,
   0x0BA2E8B, 0x0B92143, 0x0B81702, 0x0B70FBB, 0x0B60B60, 0x0B509E6, 0x0B40B40, 0x0B30F63,
   0x0B21642, 0x0B11FD3, 0x0B02C0B, 0x0AF3ADD, 0x0AE4C41, 0x0AD602B, 0x0AC7691, 0x0AB8F69,
   0x0AAAAAA, 0x0A9C84A, 0x0A8E83F, 0x0A80A80, 0x0A72F05, 0x0A655C4, 0x0A57EB5, 0x0A4A9CF,
   0x0A3D70A, 0x0A3065E, 0x0A237C3, 0x0A16B31, 0x0A0A0A0, 0x09FD809, 0x09F1165, 0x09E4CAD,
   0x09D89D8, 0x09CC8E1, 0x09C09C0, 0x09B4C6F, 0x09A90E7, 0x099D722, 0x0991F1A, 0x09868C8,
   0x097B425, 0x097012E, 0x0964FDA, 0x095A025, 0x094F209, 0x0944580, 0x0939A85, 0x092F113,
   0x0924924, 0x091A2B3, 0x090FDBC, 0x0905A38, 0x08FB823, 0x08F1779, 0x08E7835, 0x08DDA52,
   0x08D3DCB, 0x08CA29C, 0x08C08C0, 0x08B7034, 0x08AD8F2, 0x08A42F8, 0x089AE40, 0x0891AC7,
   0x0888888, 0x087F780, 0x08767AB, 0x086D905, 0x0864B8A, 0x085BF37, 0x0853408, 0x084A9F9,
   0x0842108, 0x0839930, 0x083126E, 0x0828CBF, 0x0820820, 0x081848D, 0x0810204, 0x0808080,
         0x0,       0x0 };

long gpoly_divtable[][64] = {
   {-8388607,-8388607,-8388607,-8388607,-8388607,-8388607,-8388607,-8388607,
    -8388607,-8388607,-8388607,-8388607,-8388607,-8388607,-8388607,-8388607,
    -8388607,-8388607,-8388607,-8388607,-8388607,-8388607,-8388607,-8388607,
    -8388607,-8388607,-8388607,-8388607,-8388607,-8388607,-8388607,-8388607,
           0, 8388607, 8388607, 8388607, 8388607, 8388607, 8388607, 8388607,
     8388607, 8388607, 8388607, 8388607, 8388607, 8388607, 8388607, 8388607,
     8388607, 8388607, 8388607, 8388607, 8388607, 8388607, 8388607, 8388607,
     8388607, 8388607, 8388607, 8388607, 8388607, 8388607, 8388607, 8388607,},
   {-2097152,-2031616,-1966080,-1900544,-1835008,-1769472,-1703936,-1638400,
    -1572864,-1507328,-1441792,-1376256,-1310720,-1245184,-1179648,-1114112,
    -1048576, -983040, -917504, -851968, -786432, -720896, -655360, -589824,
     -524288, -458752, -393216, -327680, -262144, -196608, -131072,  -65536,
           0,   65536,  131072,  196608,  262144,  327680,  393216,  458752,
      524288,  589824,  655360,  720896,  786432,  851968,  917504,  983040,
     1048576, 1114112, 1179648, 1245184, 1310720, 1376256, 1441792, 1507328,
     1572864, 1638400, 1703936, 1769472, 1835008, 1900544, 1966080, 2031616,},
   {-1048576,-1015808, -983040, -950272, -917504, -884736, -851968, -819200,
     -786432, -753664, -720896, -688128, -655360, -622592, -589824, -557056,
     -524288, -491520, -458752, -425984, -393216, -360448, -327680, -294912,
     -262144, -229376, -196608, -163840, -131072,  -98304,  -65536,  -32768,
           0,   32768,   65536,   98304,  131072,  163840,  196608,  229376,
      262144,  294912,  327680,  360448,  393216,  425984,  458752,  491520,
      524288,  557056,  589824,  622592,  655360,  688128,  720896,  753664,
      786432,  819200,  851968,  884736,  917504,  950272,  983040, 1015808,},
   { -699050, -677205, -655360, -633514, -611669, -589824, -567978, -546133,
     -524288, -502442, -480597, -458752, -436906, -415061, -393216, -371370,
     -349525, -327680, -305834, -283989, -262144, -240298, -218453, -196608,
     -174762, -152917, -131072, -109226,  -87381,  -65536,  -43690,  -21845,
           0,   21845,   43690,   65536,   87381,  109226,  131072,  152917,
      174762,  196608,  218453,  240298,  262144,  283989,  305834,  327680,
      349525,  371370,  393216,  415061,  436906,  458752,  480597,  502442,
      524288,  546133,  567978,  589824,  611669,  633514,  655360,  677205,},
   { -524288, -507904, -491520, -475136, -458752, -442368, -425984, -409600,
     -393216, -376832, -360448, -344064, -327680, -311296, -294912, -278528,
     -262144, -245760, -229376, -212992, -196608, -180224, -163840, -147456,
     -131072, -114688,  -98304,  -81920,  -65536,  -49152,  -32768,  -16384,
           0,   16384,   32768,   49152,   65536,   81920,   98304,  114688,
      131072,  147456,  163840,  180224,  196608,  212992,  229376,  245760,
      262144,  278528,  294912,  311296,  327680,  344064,  360448,  376832,
      393216,  409600,  425984,  442368,  458752,  475136,  491520,  507904,},
   { -419430, -406323, -393216, -380108, -367001, -353894, -340787, -327680,
     -314572, -301465, -288358, -275251, -262144, -249036, -235929, -222822,
     -209715, -196608, -183500, -170393, -157286, -144179, -131072, -117964,
     -104857,  -91750,  -78643,  -65536,  -52428,  -39321,  -26214,  -13107,
           0,   13107,   26214,   39321,   52428,   65536,   78643,   91750,
      104857,  117964,  131072,  144179,  157286,  170393,  183500,  196608,
      209715,  222822,  235929,  249036,  262144,  275251,  288358,  301465,
      314572,  327680,  340787,  353894,  367001,  380108,  393216,  406323,},
   { -349525, -338602, -327680, -316757, -305834, -294912, -283989, -273066,
     -262144, -251221, -240298, -229376, -218453, -207530, -196608, -185685,
     -174762, -163840, -152917, -141994, -131072, -120149, -109226,  -98304,
      -87381,  -76458,  -65536,  -54613,  -43690,  -32768,  -21845,  -10922,
           0,   10922,   21845,   32768,   43690,   54613,   65536,   76458,
       87381,   98304,  109226,  120149,  131072,  141994,  152917,  163840,
      174762,  185685,  196608,  207530,  218453,  229376,  240298,  251221,
      262144,  273066,  283989,  294912,  305834,  316757,  327680,  338602,},
   { -299593, -290230, -280868, -271506, -262144, -252781, -243419, -234057,
     -224694, -215332, -205970, -196608, -187245, -177883, -168521, -159158,
     -149796, -140434, -131072, -121709, -112347, -102985,  -93622,  -84260,
      -74898,  -65536,  -56173,  -46811,  -37449,  -28086,  -18724,   -9362,
           0,    9362,   18724,   28086,   37449,   46811,   56173,   65536,
       74898,   84260,   93622,  102985,  112347,  121709,  131072,  140434,
      149796,  159158,  168521,  177883,  187245,  196608,  205970,  215332,
      224694,  234057,  243419,  252781,  262144,  271506,  280868,  290230,},
   { -262144, -253952, -245760, -237568, -229376, -221184, -212992, -204800,
     -196608, -188416, -180224, -172032, -163840, -155648, -147456, -139264,
     -131072, -122880, -114688, -106496,  -98304,  -90112,  -81920,  -73728,
      -65536,  -57344,  -49152,  -40960,  -32768,  -24576,  -16384,   -8192,
           0,    8192,   16384,   24576,   32768,   40960,   49152,   57344,
       65536,   73728,   81920,   90112,   98304,  106496,  114688,  122880,
      131072,  139264,  147456,  155648,  163840,  172032,  180224,  188416,
      196608,  204800,  212992,  221184,  229376,  237568,  245760,  253952,},
   { -233016, -225735, -218453, -211171, -203889, -196608, -189326, -182044,
     -174762, -167480, -160199, -152917, -145635, -138353, -131072, -123790,
     -116508, -109226, -101944,  -94663,  -87381,  -80099,  -72817,  -65536,
      -58254,  -50972,  -43690,  -36408,  -29127,  -21845,  -14563,   -7281,
           0,    7281,   14563,   21845,   29127,   36408,   43690,   50972,
       58254,   65536,   72817,   80099,   87381,   94663,  101944,  109226,
      116508,  123790,  131072,  138353,  145635,  152917,  160199,  167480,
      174762,  182044,  189326,  196608,  203889,  211171,  218453,  225735,},
   { -209715, -203161, -196608, -190054, -183500, -176947, -170393, -163840,
     -157286, -150732, -144179, -137625, -131072, -124518, -117964, -111411,
     -104857,  -98304,  -91750,  -85196,  -78643,  -72089,  -65536,  -58982,
      -52428,  -45875,  -39321,  -32768,  -26214,  -19660,  -13107,   -6553,
           0,    6553,   13107,   19660,   26214,   32768,   39321,   45875,
       52428,   58982,   65536,   72089,   78643,   85196,   91750,   98304,
      104857,  111411,  117964,  124518,  131072,  137625,  144179,  150732,
      157286,  163840,  170393,  176947,  183500,  190054,  196608,  203161,},
   { -190650, -184692, -178734, -172776, -166818, -160861, -154903, -148945,
     -142987, -137029, -131072, -125114, -119156, -113198, -107240, -101282,
      -95325,  -89367,  -83409,  -77451,  -71493,  -65536,  -59578,  -53620,
      -47662,  -41704,  -35746,  -29789,  -23831,  -17873,  -11915,   -5957,
           0,    5957,   11915,   17873,   23831,   29789,   35746,   41704,
       47662,   53620,   59578,   65536,   71493,   77451,   83409,   89367,
       95325,  101282,  107240,  113198,  119156,  125114,  131072,  137029,
      142987,  148945,  154903,  160861,  166818,  172776,  178734,  184692,},
   { -174762, -169301, -163840, -158378, -152917, -147456, -141994, -136533,
     -131072, -125610, -120149, -114688, -109226, -103765,  -98304,  -92842,
      -87381,  -81920,  -76458,  -70997,  -65536,  -60074,  -54613,  -49152,
      -43690,  -38229,  -32768,  -27306,  -21845,  -16384,  -10922,   -5461,
           0,    5461,   10922,   16384,   21845,   27306,   32768,   38229,
       43690,   49152,   54613,   60074,   65536,   70997,   76458,   81920,
       87381,   92842,   98304,  103765,  109226,  114688,  120149,  125610,
      131072,  136533,  141994,  147456,  152917,  158378,  163840,  169301,},
   { -161319, -156278, -151236, -146195, -141154, -136113, -131072, -126030,
     -120989, -115948, -110907, -105865, -100824,  -95783,  -90742,  -85700,
      -80659,  -75618,  -70577,  -65536,  -60494,  -55453,  -50412,  -45371,
      -40329,  -35288,  -30247,  -25206,  -20164,  -15123,  -10082,   -5041,
           0,    5041,   10082,   15123,   20164,   25206,   30247,   35288,
       40329,   45371,   50412,   55453,   60494,   65536,   70577,   75618,
       80659,   85700,   90742,   95783,  100824,  105865,  110907,  115948,
      120989,  126030,  131072,  136113,  141154,  146195,  151236,  156278,},
   { -149796, -145115, -140434, -135753, -131072, -126390, -121709, -117028,
     -112347, -107666, -102985,  -98304,  -93622,  -88941,  -84260,  -79579,
      -74898,  -70217,  -65536,  -60854,  -56173,  -51492,  -46811,  -42130,
      -37449,  -32768,  -28086,  -23405,  -18724,  -14043,   -9362,   -4681,
           0,    4681,    9362,   14043,   18724,   23405,   28086,   32768,
       37449,   42130,   46811,   51492,   56173,   60854,   65536,   70217,
       74898,   79579,   84260,   88941,   93622,   98304,  102985,  107666,
      112347,  117028,  121709,  126390,  131072,  135753,  140434,  145115,},
   { -139810, -135441, -131072, -126702, -122333, -117964, -113595, -109226,
     -104857, -100488,  -96119,  -91750,  -87381,  -83012,  -78643,  -74274,
      -69905,  -65536,  -61166,  -56797,  -52428,  -48059,  -43690,  -39321,
      -34952,  -30583,  -26214,  -21845,  -17476,  -13107,   -8738,   -4369,
           0,    4369,    8738,   13107,   17476,   21845,   26214,   30583,
       34952,   39321,   43690,   48059,   52428,   56797,   61166,   65536,
       69905,   74274,   78643,   83012,   87381,   91750,   96119,  100488,
      104857,  109226,  113595,  117964,  122333,  126702,  131072,  135441,},
   { -131072, -126976, -122880, -118784, -114688, -110592, -106496, -102400,
      -98304,  -94208,  -90112,  -86016,  -81920,  -77824,  -73728,  -69632,
      -65536,  -61440,  -57344,  -53248,  -49152,  -45056,  -40960,  -36864,
      -32768,  -28672,  -24576,  -20480,  -16384,  -12288,   -8192,   -4096,
           0,    4096,    8192,   12288,   16384,   20480,   24576,   28672,
       32768,   36864,   40960,   45056,   49152,   53248,   57344,   61440,
       65536,   69632,   73728,   77824,   81920,   86016,   90112,   94208,
       98304,  102400,  106496,  110592,  114688,  118784,  122880,  126976,},
   { -123361, -119506, -115651, -111796, -107941, -104086, -100231,  -96376,
      -92521,  -88666,  -84811,  -80956,  -77101,  -73246,  -69391,  -65536,
      -61680,  -57825,  -53970,  -50115,  -46260,  -42405,  -38550,  -34695,
      -30840,  -26985,  -23130,  -19275,  -15420,  -11565,   -7710,   -3855,
           0,    3855,    7710,   11565,   15420,   19275,   23130,   26985,
       30840,   34695,   38550,   42405,   46260,   50115,   53970,   57825,
       61680,   65536,   69391,   73246,   77101,   80956,   84811,   88666,
       92521,   96376,  100231,  104086,  107941,  111796,  115651,  119506,},
   { -116508, -112867, -109226, -105585, -101944,  -98304,  -94663,  -91022,
      -87381,  -83740,  -80099,  -76458,  -72817,  -69176,  -65536,  -61895,
      -58254,  -54613,  -50972,  -47331,  -43690,  -40049,  -36408,  -32768,
      -29127,  -25486,  -21845,  -18204,  -14563,  -10922,   -7281,   -3640,
           0,    3640,    7281,   10922,   14563,   18204,   21845,   25486,
       29127,   32768,   36408,   40049,   43690,   47331,   50972,   54613,
       58254,   61895,   65536,   69176,   72817,   76458,   80099,   83740,
       87381,   91022,   94663,   98304,  101944,  105585,  109226,  112867,},
   { -110376, -106927, -103477, -100028,  -96579,  -93130,  -89680,  -86231,
      -82782,  -79333,  -75883,  -72434,  -68985,  -65536,  -62086,  -58637,
      -55188,  -51738,  -48289,  -44840,  -41391,  -37941,  -34492,  -31043,
      -27594,  -24144,  -20695,  -17246,  -13797,  -10347,   -6898,   -3449,
           0,    3449,    6898,   10347,   13797,   17246,   20695,   24144,
       27594,   31043,   34492,   37941,   41391,   44840,   48289,   51738,
       55188,   58637,   62086,   65536,   68985,   72434,   75883,   79333,
       82782,   86231,   89680,   93130,   96579,  100028,  103477,  106927,},
   { -104857, -101580,  -98304,  -95027,  -91750,  -88473,  -85196,  -81920,
      -78643,  -75366,  -72089,  -68812,  -65536,  -62259,  -58982,  -55705,
      -52428,  -49152,  -45875,  -42598,  -39321,  -36044,  -32768,  -29491,
      -26214,  -22937,  -19660,  -16384,  -13107,   -9830,   -6553,   -3276,
           0,    3276,    6553,    9830,   13107,   16384,   19660,   22937,
       26214,   29491,   32768,   36044,   39321,   42598,   45875,   49152,
       52428,   55705,   58982,   62259,   65536,   68812,   72089,   75366,
       78643,   81920,   85196,   88473,   91750,   95027,   98304,  101580,},
   {  -99864,  -96743,  -93622,  -90502,  -87381,  -84260,  -81139,  -78019,
      -74898,  -71777,  -68656,  -65536,  -62415,  -59294,  -56173,  -53052,
      -49932,  -46811,  -43690,  -40569,  -37449,  -34328,  -31207,  -28086,
      -24966,  -21845,  -18724,  -15603,  -12483,   -9362,   -6241,   -3120,
           0,    3120,    6241,    9362,   12483,   15603,   18724,   21845,
       24966,   28086,   31207,   34328,   37449,   40569,   43690,   46811,
       49932,   53052,   56173,   59294,   62415,   65536,   68656,   71777,
       74898,   78019,   81139,   84260,   87381,   90502,   93622,   96743,},
   {  -95325,  -92346,  -89367,  -86388,  -83409,  -80430,  -77451,  -74472,
      -71493,  -68514,  -65536,  -62557,  -59578,  -56599,  -53620,  -50641,
      -47662,  -44683,  -41704,  -38725,  -35746,  -32768,  -29789,  -26810,
      -23831,  -20852,  -17873,  -14894,  -11915,   -8936,   -5957,   -2978,
           0,    2978,    5957,    8936,   11915,   14894,   17873,   20852,
       23831,   26810,   29789,   32768,   35746,   38725,   41704,   44683,
       47662,   50641,   53620,   56599,   59578,   62557,   65536,   68514,
       71493,   74472,   77451,   80430,   83409,   86388,   89367,   92346,},
   {  -91180,  -88331,  -85481,  -82632,  -79782,  -76933,  -74084,  -71234,
      -68385,  -65536,  -62686,  -59837,  -56987,  -54138,  -51289,  -48439,
      -45590,  -42740,  -39891,  -37042,  -34192,  -31343,  -28493,  -25644,
      -22795,  -19945,  -17096,  -14246,  -11397,   -8548,   -5698,   -2849,
           0,    2849,    5698,    8548,   11397,   14246,   17096,   19945,
       22795,   25644,   28493,   31343,   34192,   37042,   39891,   42740,
       45590,   48439,   51289,   54138,   56987,   59837,   62686,   65536,
       68385,   71234,   74084,   76933,   79782,   82632,   85481,   88331,},
   {  -87381,  -84650,  -81920,  -79189,  -76458,  -73728,  -70997,  -68266,
      -65536,  -62805,  -60074,  -57344,  -54613,  -51882,  -49152,  -46421,
      -43690,  -40960,  -38229,  -35498,  -32768,  -30037,  -27306,  -24576,
      -21845,  -19114,  -16384,  -13653,  -10922,   -8192,   -5461,   -2730,
           0,    2730,    5461,    8192,   10922,   13653,   16384,   19114,
       21845,   24576,   27306,   30037,   32768,   35498,   38229,   40960,
       43690,   46421,   49152,   51882,   54613,   57344,   60074,   62805,
       65536,   68266,   70997,   73728,   76458,   79189,   81920,   84650,},
   {  -83886,  -81264,  -78643,  -76021,  -73400,  -70778,  -68157,  -65536,
      -62914,  -60293,  -57671,  -55050,  -52428,  -49807,  -47185,  -44564,
      -41943,  -39321,  -36700,  -34078,  -31457,  -28835,  -26214,  -23592,
      -20971,  -18350,  -15728,  -13107,  -10485,   -7864,   -5242,   -2621,
           0,    2621,    5242,    7864,   10485,   13107,   15728,   18350,
       20971,   23592,   26214,   28835,   31457,   34078,   36700,   39321,
       41943,   44564,   47185,   49807,   52428,   55050,   57671,   60293,
       62914,   65536,   68157,   70778,   73400,   76021,   78643,   81264,},
   {  -80659,  -78139,  -75618,  -73097,  -70577,  -68056,  -65536,  -63015,
      -60494,  -57974,  -55453,  -52932,  -50412,  -47891,  -45371,  -42850,
      -40329,  -37809,  -35288,  -32768,  -30247,  -27726,  -25206,  -22685,
      -20164,  -17644,  -15123,  -12603,  -10082,   -7561,   -5041,   -2520,
           0,    2520,    5041,    7561,   10082,   12603,   15123,   17644,
       20164,   22685,   25206,   27726,   30247,   32768,   35288,   37809,
       40329,   42850,   45371,   47891,   50412,   52932,   55453,   57974,
       60494,   63015,   65536,   68056,   70577,   73097,   75618,   78139,},
   {  -77672,  -75245,  -72817,  -70390,  -67963,  -65536,  -63108,  -60681,
      -58254,  -55826,  -53399,  -50972,  -48545,  -46117,  -43690,  -41263,
      -38836,  -36408,  -33981,  -31554,  -29127,  -26699,  -24272,  -21845,
      -19418,  -16990,  -14563,  -12136,   -9709,   -7281,   -4854,   -2427,
           0,    2427,    4854,    7281,    9709,   12136,   14563,   16990,
       19418,   21845,   24272,   26699,   29127,   31554,   33981,   36408,
       38836,   41263,   43690,   46117,   48545,   50972,   53399,   55826,
       58254,   60681,   63108,   65536,   67963,   70390,   72817,   75245,},
   {  -74898,  -72557,  -70217,  -67876,  -65536,  -63195,  -60854,  -58514,
      -56173,  -53833,  -51492,  -49152,  -46811,  -44470,  -42130,  -39789,
      -37449,  -35108,  -32768,  -30427,  -28086,  -25746,  -23405,  -21065,
      -18724,  -16384,  -14043,  -11702,   -9362,   -7021,   -4681,   -2340,
           0,    2340,    4681,    7021,    9362,   11702,   14043,   16384,
       18724,   21065,   23405,   25746,   28086,   30427,   32768,   35108,
       37449,   39789,   42130,   44470,   46811,   49152,   51492,   53833,
       56173,   58514,   60854,   63195,   65536,   67876,   70217,   72557,},
   {  -72315,  -70055,  -67795,  -65536,  -63276,  -61016,  -58756,  -56496,
      -54236,  -51976,  -49716,  -47457,  -45197,  -42937,  -40677,  -38417,
      -36157,  -33897,  -31638,  -29378,  -27118,  -24858,  -22598,  -20338,
      -18078,  -15819,  -13559,  -11299,   -9039,   -6779,   -4519,   -2259,
           0,    2259,    4519,    6779,    9039,   11299,   13559,   15819,
       18078,   20338,   22598,   24858,   27118,   29378,   31638,   33897,
       36157,   38417,   40677,   42937,   45197,   47457,   49716,   51976,
       54236,   56496,   58756,   61016,   63276,   65536,   67795,   70055,},
   {  -69905,  -67720,  -65536,  -63351,  -61166,  -58982,  -56797,  -54613,
      -52428,  -50244,  -48059,  -45875,  -43690,  -41506,  -39321,  -37137,
      -34952,  -32768,  -30583,  -28398,  -26214,  -24029,  -21845,  -19660,
      -17476,  -15291,  -13107,  -10922,   -8738,   -6553,   -4369,   -2184,
           0,    2184,    4369,    6553,    8738,   10922,   13107,   15291,
       17476,   19660,   21845,   24029,   26214,   28398,   30583,   32768,
       34952,   37137,   39321,   41506,   43690,   45875,   48059,   50244,
       52428,   54613,   56797,   58982,   61166,   63351,   65536,   67720,},
   {  -67650,  -65536,  -63421,  -61307,  -59193,  -57079,  -54965,  -52851,
      -50737,  -48623,  -46509,  -44395,  -42281,  -40167,  -38053,  -35939,
      -33825,  -31710,  -29596,  -27482,  -25368,  -23254,  -21140,  -19026,
      -16912,  -14798,  -12684,  -10570,   -8456,   -6342,   -4228,   -2114,
           0,    2114,    4228,    6342,    8456,   10570,   12684,   14798,
       16912,   19026,   21140,   23254,   25368,   27482,   29596,   31710,
       33825,   35939,   38053,   40167,   42281,   44395,   46509,   48623,
       50737,   52851,   54965,   57079,   59193,   61307,   63421,   65536,},
};

// Static variables used only inside draw_gpoly().
// These don't really have to be global; but this helps
// in using these inside assembly code
long gpoly_mode;
long factor_ca,factor_ba,factor_cb,factor_chk;
// More variables - made global temporarly to ease assembly rewriting
struct PolyPoint *gploc_point_a,*gploc_point_b;
long gploc_point_c;
long gploc_1A4,gploc_1A0;
short gploc_word01,gploc_word02,gploc_word03;
long gploc_198,mapxveltop,gploc_18C,mapyveltop,gploc_180;
long gploc_pt_ay,gploc_pt_ax,gploc_pt_shax,gploc_pt_as,gploc_pt_au,gploc_pt_av;
long gploc_pt_by,gploc_pt_bx,gploc_pt_shbx,gploc_pt_bs,gploc_pt_bu,gploc_pt_bv;
long gploc_pt_cy,gploc_pt_cx,gploc_pt_shcx,gploc_pt_cs,gploc_pt_cu,gploc_pt_cv;
long gploc_12C,gploc_128,gploc_104,g_shadeAccumulator,g_shadeAccumulatorNext,gploc_E4,gploc_E0;
uint8_t * gploc_F4;
long gploc_D8,gploc_D4,gploc_CC,gploc_C8,gploc_C4,gploc_C0,gploc_BC,gploc_B8,gploc_B4,mapxhstep,mapyhstep,gploc_A7,shadehstep,gploc_A4,gploc_A0,gploc_9C;
long gploc_98,gploc_94,gploc_90,gploc_8C,gploc_88,gploc_84,gploc_80,gploc_7C,gploc_78,gploc_74,gploc_68,gploc_64,gploc_60;
long gploc_5C,startposshadetop,startposmapxtop,startposmapytop,startposshadebottom,startposmapxbottom,startposmapybottom,gploc_34,gploc_30,gploc_2C,gploc_28;
/******************************************************************************/


#undef __ROL4__
#define __ROL4__(val, shift) \
    (uint32_t)( ((uint32_t)(val) << (shift)) | ((uint32_t)(val) >> (32 - (shift))) )

static inline uint64_t CFADD64(uint64_t a_low, uint64_t b_low)
{
    // Return 1 if (a_low + b_low) overflows 32 bits
    uint64_t sum = a_low + b_low;
    return (sum < a_low) ? 1u : 0u;
}

static inline uint64_t PAIR64(uint32_t high32, uint32_t low32) {
    return ((uint64_t)high32 << 32) | (uint64_t)low32;
}

// Some convenience macros to make partial accesses nicer
#define LAST_IND(x,part_type)    (sizeof(x)/sizeof(part_type) - 1)
#if defined(__BYTE_ORDER) && __BYTE_ORDER == __BIG_ENDIAN
#  define LOW_IND(x,part_type)   LAST_IND(x,part_type)
#  define HIGH_IND(x,part_type)  0
#else
#  define HIGH_IND(x,part_type)  LAST_IND(x,part_type)
#  define LOW_IND(x,part_type)   0
#endif
// first unsigned macros:
#define BYTEn(x, n)   (*((_BYTE*)&(x)+n))
#define WORDn(x, n)   (*((_WORD*)&(x)+n))
#define DWORDn(x, n)  (*((_DWORD*)&(x)+n))

#define LOBYTE(x)  BYTEn(x,LOW_IND(x,_BYTE))
#define LOWORD(x)  WORDn(x,LOW_IND(x,_WORD))
#define LODWORD(x) DWORDn(x,LOW_IND(x,_DWORD))
#define HIBYTE(x)  BYTEn(x,HIGH_IND(x,_BYTE))
#define HIWORD(x)  WORDn(x,HIGH_IND(x,_WORD))
#define HIDWORD(x) DWORDn(x,HIGH_IND(x,_DWORD))


void draw_gpoly_sub1a();
void draw_gpoly_sub1b();
void draw_gpoly_sub1c();
void draw_gpoly_sub2a();
void draw_gpoly_sub2b();
void draw_gpoly_sub2c();
void draw_gpoly_sub3a();
void draw_gpoly_sub3b();
void draw_gpoly_sub4();
void draw_gpoly_sub5();
void draw_gpoly_sub6();
void draw_gpoly_sub7a();
void draw_gpoly_sub7b();
void draw_gpoly_sub13();
void draw_gpoly_sub14();


void draw_gpoly(struct PolyPoint *point_a, struct PolyPoint *point_b, struct PolyPoint *point_c)
{
    LOC_poly_screen = poly_screen;
    LOC_vec_map = vec_map;
    LOC_vec_screen = vec_screen;
    LOC_vec_screen_width = vec_screen_width;
    LOC_vec_window_width = vec_window_width;
    LOC_vec_window_height = vec_window_height;
    gpoly_mode = 64 + vec_mode;
    { // Check for outranged poly size
        // test lengths
        int len_bc_x = point_b->X - point_c->X;
        if ((len_bc_x < -16383) || (len_bc_x > 16383))
            return;
        int len_bc_y = point_b->Y - point_c->Y;
        if ((len_bc_y < -16383) || (len_bc_y > 16383))
            return;
        int len_ba_x = point_b->X - point_a->X;
        if ((len_ba_x < -16383) || (len_ba_x > 16383))
            return;
        int len_ca_y = point_c->Y - point_a->Y;
        if ((len_ca_y < -16383) || (len_ca_y > 16383))
            return;
        int len_ca_x = point_c->X - point_a->X;
        if ((len_ca_x < -16383) || (len_ca_x > 16383))
            return;
        int len_ba_y = point_b->Y - point_a->Y;
        if ((len_ba_y < -16383) || (len_ba_y > 16383))
            return;
        // test area
        if ((len_ca_x * len_ba_y) - (len_ba_x * len_ca_y) >= 0)
            return;
    }
    long exceeds_window = ((point_a->X | point_b->X | point_c->X) < 0) || (point_a->X > vec_window_width) || (point_b->X > vec_window_width) || (point_c->X > vec_window_width);
    { // Reorder points
        int min_y = point_a->Y;
        struct PolyPoint* point_tmp;
        if (min_y > point_b->Y)
        {
            min_y = point_b->Y;
            point_tmp = point_a;
            point_a = point_b;
            point_b = point_tmp;
        }
        if (min_y > point_c->Y)
        {
            point_tmp = point_a;
            point_a = point_c;
            point_c = point_tmp;
        }
        if (point_b->Y > point_c->Y)
        {
            point_tmp = point_b;
            point_b = point_c;
            point_c = point_tmp;
        }
    }
    // Check if y coord is same for all of them
    if (point_a->Y == point_c->Y)
        return;
    {
        long len_y = point_c->Y - point_a->Y;
        long len_x = point_c->X - point_a->X;
        if (len_y != 0)
        {
            if ((len_y < 0) || (len_y > 31) || (len_x < -32) || (len_x > 31))
                factor_ca = (len_x << 16) / len_y;
            else
                factor_ca = gpoly_divtable[len_y][len_x+32];
        } else
        {
            if (len_x < -32)
                factor_ca = gpoly_divtable[len_y][-32+32];
            else
            if (len_x > 31)
                factor_ca = gpoly_divtable[len_y][31+32];
            else
                factor_ca = gpoly_divtable[len_y][len_x+32];
        }
        len_y = point_b->Y - point_a->Y;
        len_x = point_b->X - point_a->X;
        if (len_y != 0)
        {
            if ((len_y < 0) || (len_y > 31) || (len_x < -32) || (len_x > 31))
                factor_ba = (len_x << 16) / len_y;
            else
                factor_ba = gpoly_divtable[len_y][len_x+32];
        } else
        {
            if (len_x < -32)
                factor_ba = gpoly_divtable[len_y][-32+32];
            else
            if (len_x > 31)
                factor_ba = gpoly_divtable[len_y][31+32];
            else
                factor_ba = gpoly_divtable[len_y][len_x+32];
        }
        len_y = point_c->Y - point_b->Y;
        len_x = point_c->X - point_b->X;
        if (len_y != 0)
        {
            if ((len_y < 0) || (len_y > 31) || (len_x < -32) || (len_x > 31))
                factor_cb = (len_x << 16) / len_y;
            else
                factor_cb = gpoly_divtable[len_y][len_x+32];
        } else
        {
            if (len_x < -32)
                factor_cb = gpoly_divtable[len_y][-32+32];
            else
            if (len_x > 31)
                factor_cb = gpoly_divtable[len_y][31+32];
            else
                factor_cb = gpoly_divtable[len_y][len_x+32];
        }
        len_x = (point_a->X << 16) - (point_b->X << 16);
        len_y = (point_b->Y - point_a->Y);
        factor_chk = len_y * factor_ca + len_x;
    }

    gploc_pt_ax = point_a->X;
    gploc_pt_ay = point_a->Y;
    gploc_pt_shax = point_a->X << 16;
    gploc_pt_bx = point_b->X;
    gploc_pt_by = point_b->Y;
    gploc_pt_shbx = point_b->X << 16;
    gploc_pt_cx = point_c->X;
    gploc_pt_cy = point_c->Y;
    gploc_pt_shcx = point_c->X << 16;
    gploc_pt_as   = point_a->S >> 16;
    gploc_pt_bs   = point_b->S >> 16;
    gploc_pt_cs   = point_c->S >> 16;
    gploc_pt_au   = point_a->U >> 16;
    gploc_pt_av   = point_a->V >> 16;
    gploc_pt_bu   = point_b->U >> 16;
    gploc_pt_bv   = point_b->V >> 16;
    gploc_pt_cu   = point_c->U >> 16;
    gploc_pt_cv   = point_c->V >> 16;


    gploc_point_a = point_a;
    gploc_point_b = point_b;

    switch (gpoly_mode)
    {
    case 27:
    case 29:
    case 31:
    case 32:
    case 33:
    case 34:
    case 37:
    case 38:
    case 91:
    case 93:
    case 95:
    case 96:
    case 97:
    case 98:
    case 101:
    case 102:
    ERRORLOG("draw_gpoly1: gpoly_mode %ld\n", gpoly_mode);
        draw_gpoly_sub1a();
        draw_gpoly_sub1b();
        draw_gpoly_sub1c();
        break;
    case 28:
    case 30:
    case 35:
    case 36:
    case 39:
    case 40:
    case 92:
    case 94:
    case 99:
    case 100:
    case 103:
    case 104:
    ERRORLOG("draw_gpoly2: gpoly_mode %ld\n", gpoly_mode);
        draw_gpoly_sub2a();
        draw_gpoly_sub2b();
        draw_gpoly_sub2c();
        break;
    case 4:
    case 16:
    case 17:
    case 68:
    case 80:
    case 81:
    ERRORLOG("draw_gpoly3: gpoly_mode %ld\n", gpoly_mode);
        draw_gpoly_sub3a();
        draw_gpoly_sub3b();
        break;
    case 3:
    case 12:
    case 13:
    case 18:
    case 19:
    case 22:
    case 23:
    case 67:
    case 76:
    case 77:
    case 82:
    case 83:
    case 86:
    case 87:
    ERRORLOG("draw_gpoly4: gpoly_mode %ld\n", gpoly_mode);
        draw_gpoly_sub4();
        break;
    case 2:
    case 66:
    ERRORLOG("draw_gpoly5: gpoly_mode %ld\n", gpoly_mode);
        draw_gpoly_sub5();
        break;
    case 5:
    case 6:
    case 20:
    case 21:
    case 24:
    case 25:
    case 70:
    case 84:
    case 85:
    case 88:
    case 89:
    ERRORLOG("draw_gpoly6: gpoly_mode %ld\n", gpoly_mode);
        draw_gpoly_sub6();
        break;
    case 69:
        draw_gpoly_sub7a();
        draw_gpoly_sub7b();
        break;
    case 43:
    case 44:
    case 45:
    case 46:
    case 47:
    case 48:
    case 49:
    case 50:
    case 51:
    case 52:
    case 53:
    case 54:
    case 55:
    case 56:
    case 57:
    case 58:
    case 59:
    case 60:
    case 61:
    case 62:
    case 63:
      return;
    }

    // End of first switch - now the second
    switch (gpoly_mode)
    {
    case 64+5: //Pentium pro index + 5
        if (exceeds_window)
        {
            gploc_104 = LOC_vec_screen_width;
            gploc_180 = 2;
            gploc_60 = gploc_68;
            gploc_CC = gploc_A4;
            gploc_C4 = gploc_A0;
            if (factor_chk < 0)
            {
                gploc_12C = factor_ca;
                gploc_128 = factor_ba;

            } else
            {
                gploc_12C = factor_ba;
                gploc_128 = factor_ca;
            }
            draw_gpoly_sub13();
        } else // not exceeds_window
        {
            gploc_104 = LOC_vec_screen_width;
            gploc_180 = 2;
            gploc_60 = gploc_68;
            gploc_CC = gploc_A4;
            gploc_C4 = gploc_A0;
            if (factor_chk < 0)
            {
                gploc_12C = factor_ca;
                gploc_128 = factor_ba;
            } else
            {
                gploc_12C = factor_ba;
                gploc_128 = factor_ca;
            }
            draw_gpoly_sub14();
        }
        break;
    }
}

static void unk_update_gpoly1_tri8a(long * vout0, long * vout1, long vinp2, long vin0, long delta)
{
    long tmp1 = (vin0 << 16);
    long tmp2 = (vin0 >> 16);
    tmp1 += (unsigned char)(vinp2);
    if ( (char)(vinp2) < 0 )
    {
        long tmp3 = (unsigned int)tmp1 < delta;
        tmp1 -= delta;
        tmp2 = (tmp2 & ~0xff) | ((tmp2 - tmp3) & 0xff);
    }
    *vout1 = tmp1;
    *vout0 = tmp2;
}

static void unk_update_gpoly1_tri16a(long * vout0, long * vout1, long vinp2, long vin0, long delta)
{
    long tmp1 = (vin0 << 16);
    long tmp2 = (vin0 >> 16);
    tmp1 += (unsigned short)(vinp2);
    if ( (short)(vinp2) < 0 )
    {
        long tmp3 = (unsigned int)tmp1 < delta;
        tmp1 -= delta;
        tmp2 = (tmp2 & ~0xff) | ((tmp2 - tmp3) & 0xff);
    }
    *vout1 = tmp1;
    *vout0 = tmp2;
}

static void unk_update_gpoly1_tri8b(long * vout0, long * vout1, long * vout2, long vin0, long vin1)
{
    *vout2 = (vin1 << 16);
    long tmp1 = (vin0 << 16);
    tmp1 += ((unsigned int)vin1 >> 16) & 0xff;
    *vout1 = tmp1;
    *vout0 = (unsigned int)(vin0 << 8) >> 24 << 8;
}

static void unk_update_gpoly1_tri16b(long * vout0, long * vout1, long * vout2, long vin0, long vin1, long vin2)
{
    long tmp1 = (vin1 << 16);
    tmp1 += ((unsigned int)vin2 >> 8) & 0xffff;
    *vout2 = tmp1;
    tmp1 = (vin0 << 16);
    tmp1 += ((unsigned int)vin1 >> 16) & 0xff;
    *vout1 = tmp1;
    tmp1 = (unsigned int)(vin0 << 8) >> 24 << 8;
    tmp1 += (vin2) & 0xff;
    *vout0 = tmp1;
}

void draw_gpoly_sub1a()
{
#if __GNUC__
    asm volatile (" \
    pusha   \n \
    movl    _gploc_pt_bx,%%esi\n \
    movl    _factor_chk,%%edi\n \
    orl %%edi,%%edi\n \
    subl    $0,%%esi\n \
    addl    $0,%%esi\n \
    movl    _gploc_pt_ax,%%eax\n \
    subl    %%eax,%%esi\n \
    movl    _gploc_pt_cx,%%edi\n \
    subl    %%eax,%%edi\n \
    movl    _gploc_pt_ay,%%eax\n \
    movl    _gploc_pt_by,%%ebx\n \
    subl    %%eax,%%ebx\n \
    movl    _gploc_pt_cy,%%ecx\n \
    subl    %%eax,%%ecx\n \
    movl    %%ecx,%%eax\n \
    imull   %%esi,%%ecx\n \
    movl    _factor_chk,%%ebp\n \
    orl %%ebp,%%ebp\n \
    js  gpo_loc_0532\n \
    subl    %%eax,%%ecx\n \
    subl    %%eax,%%ecx\n \
\n \
gpo_loc_0532:         # 33C\n \
    addl    %%eax,%%ecx\n \
    imull   %%edi,%%ebx\n \
    subl    %%ecx,%%ebx\n \
    jz  gpo_loc_05B8\n \
    xorl    %%edx,%%edx\n \
    movl    $0x7FFFFFFF,%%eax\n \
    idivl   %%ebx\n \
    movl    %%eax,%%ebp\n \
    movl    _gploc_pt_ay,%%eax\n \
    movl    _gploc_pt_cy,%%esi\n \
    subl    %%eax,%%esi\n \
    movl    _gploc_pt_by,%%edi\n \
    subl    %%eax,%%edi\n \
    movl    %%ebp,%%eax\n \
    movl    _gploc_pt_au,%%edx\n \
    movl    _gploc_pt_cu,%%ebx\n \
    subl    %%edx,%%ebx\n \
    movl    _gploc_pt_bu,%%ecx\n \
    subl    %%edx,%%ecx\n \
    imull   %%esi,%%ecx\n \
    imull   %%edi,%%ebx\n \
    subl    %%ecx,%%ebx\n \
    imull   %%ebx\n \
    shll    $1,%%eax\n \
    rcll    $1,%%edx\n \
    movw    %%dx,%%ax\n \
    roll    $0x10,%%eax\n \
    jns gpo_loc_057F\n \
    incl    %%eax\n \
\n \
gpo_loc_057F:         # 38C\n \
    movl    %%eax,_mapxhstep\n \
    movl    %%ebp,%%eax\n \
    movl    _gploc_pt_av,%%edx\n \
    movl    _gploc_pt_cv,%%ebx\n \
    subl    %%edx,%%ebx\n \
    movl    _gploc_pt_bv,%%ecx\n \
    subl    %%edx,%%ecx\n \
    imull   %%esi,%%ecx\n \
    imull   %%edi,%%ebx\n \
    subl    %%ecx,%%ebx\n \
    imull   %%ebx\n \
    shll    $1,%%eax\n \
    rcll    $1,%%edx\n \
    movw    %%dx,%%ax\n \
    roll    $0x10,%%eax\n \
    jns gpo_loc_05AF\n \
    incl    %%eax\n \
\n \
gpo_loc_05AF:         # 3BC\n \
    movl    %%eax,_mapyhstep\n \
    jmp gpo_loc_05C8\n \
# ---------------------------------------------------------------------------\n \
\n \
gpo_loc_05B8:         # 34\n \
    xorl    %%eax,%%eax\n \
    movl    %%eax,_mapxhstep\n \
    movl    %%eax,_mapyhstep\n \
\n \
gpo_loc_05C8:         # 3C6\n \
    popa    \n \
" : : : "memory", "cc");
#endif
}

void draw_gpoly_sub1b()
{
#if __GNUC__
    asm volatile (" \
    pusha   \n \
    movl    _factor_chk,%%esi\n \
    orl %%esi,%%esi\n \
    js  gpo_loc_0715\n \
    movl    _gploc_pt_by,%%ecx\n \
    subl    _gploc_pt_ay,%%ecx\n \
    cmpl    $0x0FF,%%ecx\n \
    jg  gpo_loc_05ED\n \
    movl    _gpoly_reptable(,%%ecx,4),%%ebx\n \
    jmp gpo_loc_05FB\n \
# ---------------------------------------------------------------------------\n \
\n \
gpo_loc_05ED:         # 3F2\n \
    movl    $0,%%edx\n \
    movl    $0x7FFFFFFF,%%eax\n \
    idivl   %%ecx\n \
    movl    %%eax,%%ebx\n \
\n \
gpo_loc_05FB:         # 3FB\n \
    movl    _gploc_pt_bu,%%eax\n \
    subl    _gploc_pt_au,%%eax\n \
    shll    $1,%%eax\n \
    imull   %%ebx\n \
    movw    %%dx,%%ax\n \
    roll    $0x10,%%eax\n \
    jns gpo_loc_0610\n \
    incl    %%eax\n \
\n \
gpo_loc_0610:         # 41D\n \
    movl    %%eax,_mapxveltop\n \
    movl    _gploc_pt_bv,%%eax\n \
    subl    _gploc_pt_av,%%eax\n \
    shll    $1,%%eax\n \
    imull   %%ebx\n \
    movw    %%dx,%%ax\n \
    roll    $0x10,%%eax\n \
    jns gpo_loc_0629\n \
    incl    %%eax\n \
\n \
gpo_loc_0629:         # 436\n \
    movl    %%eax,_mapyveltop\n \
    movl    _gploc_pt_cy,%%ecx\n \
    subl    _gploc_pt_by,%%ecx\n \
    cmpl    $0x0FF,%%ecx\n \
    jg  gpo_loc_0646\n \
    movl    _gpoly_reptable(,%%ecx,4),%%ebx\n \
    jmp gpo_loc_0654\n \
# ---------------------------------------------------------------------------\n \
\n \
gpo_loc_0646:         # 44B\n \
    movl    $0,%%edx\n \
    movl    $0x7FFFFFFF,%%eax\n \
    idivl   %%ecx\n \
    movl    %%eax,%%ebx\n \
\n \
gpo_loc_0654:         # 45\n \
    movl    _gploc_pt_cu,%%eax\n \
    subl    _gploc_pt_bu,%%eax\n \
    shll    $1,%%eax\n \
    imull   %%ebx\n \
    movw    %%dx,%%ax\n \
    roll    $0x10,%%eax\n \
    jns gpo_loc_0669\n \
    incl    %%eax\n \
\n \
gpo_loc_0669:         # 476\n \
    movl    %%eax,_gploc_198\n \
    movl    _gploc_pt_cv,%%eax\n \
    subl    _gploc_pt_bv,%%eax\n \
    shll    $1,%%eax\n \
    imull   %%ebx\n \
    movw    %%dx,%%ax\n \
    roll    $0x10,%%eax\n \
    jns gpo_loc_0682\n \
    incl    %%eax\n \
\n \
gpo_loc_0682:         # 48\n \
    movl    %%eax,_gploc_18C\n \
    movl    _gploc_point_a,%%eax\n \
    movl    _mapxhstep,%%ebx\n \
    imull   %%ebx\n \
    movw    %%dx,%%ax\n \
    roll    $0x10,%%eax\n \
    subl    %%eax,_mapxveltop\n \
    movl    _gploc_point_a,%%eax\n \
    movl    _mapyhstep,%%ebx\n \
    imull   %%ebx\n \
    movw    %%dx,%%ax\n \
    roll    $0x10,%%eax\n \
    subl    %%eax,_mapyveltop\n \
    movl    _gploc_point_a,%%eax\n \
    movl    _shadehstep,%%ebx\n \
    imull   %%ebx\n \
    movw    %%dx,%%ax\n \
    roll    $0x10,%%eax\n \
    subl    %%eax,_gploc_point_c\n \
    movl    _gploc_point_b,%%eax\n \
    movl    _mapxhstep,%%ebx\n \
    imull   %%ebx\n \
    movw    %%dx,%%ax\n \
    roll    $0x10,%%eax\n \
    subl    %%eax,_gploc_198\n \
    movl    _gploc_point_b,%%eax\n \
    movl    _mapyhstep,%%ebx\n \
    imull   %%ebx\n \
    movw    %%dx,%%ax\n \
    roll    $0x10,%%eax\n \
    subl    %%eax,_gploc_18C\n \
    movl    _gploc_point_b,%%eax\n \
    movl    _shadehstep,%%ebx\n \
    imull   %%ebx\n \
    movw    %%dx,%%ax\n \
    roll    $0x10,%%eax\n \
    subl    %%eax,_gploc_1A0\n \
    jmp gpo_loc_07B0\n \
# ---------------------------------------------------------------------------\n \
\n \
gpo_loc_0715:         # 3DE\n \
    movl    _gploc_pt_cy,%%ecx\n \
    subl    _gploc_pt_ay,%%ecx\n \
    cmpl    $0x0FF,%%ecx\n \
    jg  gpo_loc_072E\n \
    movl    _gpoly_reptable(,%%ecx,4),%%ebx\n \
    jmp gpo_loc_073C\n \
# ---------------------------------------------------------------------------\n \
\n \
gpo_loc_072E:         # 533\n \
    movl    $0,%%edx\n \
    movl    $0x7FFFFFFF,%%eax\n \
    idivl   %%ecx\n \
    movl    %%eax,%%ebx\n \
\n \
gpo_loc_073C:         # 53C\n \
    movl    _gploc_pt_cu,%%eax\n \
    subl    _gploc_pt_au,%%eax\n \
    shll    $1,%%eax\n \
    imull   %%ebx\n \
    movw    %%dx,%%ax\n \
    roll    $0x10,%%eax\n \
    jns gpo_loc_0751\n \
    incl    %%eax\n \
\n \
gpo_loc_0751:         # 55E\n \
    movl    %%eax,_mapxveltop\n \
    movl    _gploc_pt_cv,%%eax\n \
    subl    _gploc_pt_av,%%eax\n \
    shll    $1,%%eax\n \
    imull   %%ebx\n \
    movw    %%dx,%%ax\n \
    roll    $0x10,%%eax\n \
    jns gpo_loc_076A\n \
    incl    %%eax\n \
\n \
gpo_loc_076A:         # 577\n \
    movl    %%eax,_mapyveltop\n \
    movl    _factor_ca,%%eax\n \
    movl    _mapxhstep,%%ebx\n \
    imull   %%ebx\n \
    movw    %%dx,%%ax\n \
    roll    $0x10,%%eax\n \
    subl    %%eax,_mapxveltop\n \
    movl    _factor_ca,%%eax\n \
    movl    _mapyhstep,%%ebx\n \
    imull   %%ebx\n \
    movw    %%dx,%%ax\n \
    roll    $0x10,%%eax\n \
    subl    %%eax,_mapyveltop\n \
    movl    _factor_ca,%%eax\n \
    movl    _shadehstep,%%ebx\n \
    imull   %%ebx\n \
    movw    %%dx,%%ax\n \
    roll    $0x10,%%eax\n \
    subl    %%eax,_gploc_point_c\n \
\n \
gpo_loc_07B0:         # 520\n \
    popa    \n \
" : : : "memory", "cc");
#endif
}

void draw_gpoly_sub1c()
{
    startposmapxtop = (gploc_pt_au << 16) + mapxhstep;
    startposmapytop = (gploc_pt_av << 16) + mapyhstep;
    startposmapxbottom = (gploc_pt_bu << 16) + mapxhstep;
    startposmapybottom = (gploc_pt_bv << 16) + mapyhstep;

    gploc_BC = (mapxhstep << 16);
    gploc_B8 = (mapxhstep >> 16);
    unk_update_gpoly1_tri8a(&gploc_B4, &gploc_B8, gploc_B8, mapyhstep, 256);
    gploc_A4 = (mapxveltop << 16);
    gploc_A0 = (mapxveltop >> 16);
    unk_update_gpoly1_tri8a(&gploc_9C, &gploc_A0, gploc_A0, mapyveltop, 256);
    unk_update_gpoly1_tri8b(&gploc_84, &gploc_88, &gploc_8C, startposmapytop, startposmapxtop);
    if ( factor_chk >= 0 )
    {
        gploc_98 = (gploc_198 << 16);
        gploc_94 = (gploc_198 >> 16);
        unk_update_gpoly1_tri8a(&gploc_90, &gploc_94, gploc_94, gploc_18C, 256);
        unk_update_gpoly1_tri8b(&gploc_78, &gploc_7C, &gploc_80, startposmapybottom, startposmapxbottom);
    }
}

void draw_gpoly_sub2a()
{
#if __GNUC__
    asm volatile (" \
    pusha   \n \
    movl    _gploc_pt_bx,%%esi\n \
    movl    _factor_chk,%%edi\n \
    orl %%edi,%%edi\n \
    subl    $0,%%esi\n \
    addl    $0,%%esi\n \
    movl    _gploc_pt_ax,%%eax\n \
    subl    %%eax,%%esi\n \
    movl    _gploc_pt_cx,%%edi\n \
    subl    %%eax,%%edi\n \
    movl    _gploc_pt_ay,%%eax\n \
    movl    _gploc_pt_by,%%ebx\n \
    subl    %%eax,%%ebx\n \
    movl    _gploc_pt_cy,%%ecx\n \
    subl    %%eax,%%ecx\n \
    movl    %%ecx,%%eax\n \
    imull   %%esi,%%ecx\n \
    movl    _factor_chk,%%ebp\n \
    orl %%ebp,%%ebp\n \
    js  gpo_loc_09AC\n \
    subl    %%eax,%%ecx\n \
    subl    %%eax,%%ecx\n \
\n \
gpo_loc_09AC:         # 7B6\n \
    addl    %%eax,%%ecx\n \
    imull   %%edi,%%ebx\n \
    subl    %%ecx,%%ebx\n \
    jz  gpo_loc_0A66\n \
    xorl    %%edx,%%edx\n \
    movl    $0x7FFFFFFF,%%eax\n \
    idivl   %%ebx\n \
    movl    %%eax,%%ebp\n \
    movl    _gploc_pt_ay,%%eax\n \
    movl    _gploc_pt_cy,%%esi\n \
    subl    %%eax,%%esi\n \
    movl    _gploc_pt_by,%%edi\n \
    subl    %%eax,%%edi\n \
    movl    %%ebp,%%eax\n \
    movl    _gploc_pt_as,%%edx\n \
    movl    _gploc_pt_cs,%%ebx\n \
    subl    %%edx,%%ebx\n \
    movl    _gploc_pt_bs,%%ecx\n \
    subl    %%edx,%%ecx\n \
    imull   %%esi,%%ecx\n \
    imull   %%edi,%%ebx\n \
    subl    %%ecx,%%ebx\n \
    imull   %%ebx\n \
    shll    $1,%%eax\n \
    rcll    $1,%%edx\n \
    movw    %%dx,%%ax\n \
    roll    $0x10,%%eax\n \
    jns gpo_loc_09FD\n \
    incl    %%eax\n \
\n \
gpo_loc_09FD:         # 80A\n \
    movl    %%eax,_shadehstep\n \
    movl    %%ebp,%%eax\n \
    movl    _gploc_pt_au,%%edx\n \
    movl    _gploc_pt_cu,%%ebx\n \
    subl    %%edx,%%ebx\n \
    movl    _gploc_pt_bu,%%ecx\n \
    subl    %%edx,%%ecx\n \
    imull   %%esi,%%ecx\n \
    imull   %%edi,%%ebx\n \
    subl    %%ecx,%%ebx\n \
    imull   %%ebx\n \
    shll    $1,%%eax\n \
    rcll    $1,%%edx\n \
    movw    %%dx,%%ax\n \
    roll    $0x10,%%eax\n \
    jns gpo_loc_0A2D\n \
    incl    %%eax\n \
\n \
gpo_loc_0A2D:         # 83A\n \
    movl    %%eax,_mapxhstep\n \
    movl    %%ebp,%%eax\n \
    movl    _gploc_pt_av,%%edx\n \
    movl    _gploc_pt_cv,%%ebx\n \
    subl    %%edx,%%ebx\n \
    movl    _gploc_pt_bv,%%ecx\n \
    subl    %%edx,%%ecx\n \
    imull   %%esi,%%ecx\n \
    imull   %%edi,%%ebx\n \
    subl    %%ecx,%%ebx\n \
    imull   %%ebx\n \
    shll    $1,%%eax\n \
    rcll    $1,%%edx\n \
    movw    %%dx,%%ax\n \
    roll    $0x10,%%eax\n \
    jns gpo_loc_0A5D\n \
    incl    %%eax\n \
\n \
gpo_loc_0A5D:         # 86A\n \
    movl    %%eax,_mapyhstep\n \
    jmp gpo_loc_0A7D\n \
# ---------------------------------------------------------------------------\n \
\n \
gpo_loc_0A66:         # 7C3\n \
    xorl    %%eax,%%eax\n \
    movl    %%eax,_shadehstep\n \
    movl    %%eax,_mapxhstep\n \
    movl    %%eax,_mapyhstep\n \
\n \
gpo_loc_0A7D:         # 87\n \
    popa    \n \
" : : : "memory", "cc");
#endif
}

void draw_gpoly_sub2b()
{
#if __GNUC__
    asm volatile (" \
    pusha   \n \
    movl    _factor_chk,%%esi\n \
    orl %%esi,%%esi\n \
    js  gpo_loc_0BFC\n \
    movl    _gploc_pt_by,%%ecx\n \
    subl    _gploc_pt_ay,%%ecx\n \
    cmpl    $0x0FF,%%ecx\n \
    jg  gpo_loc_0AA2\n \
    movl    _gpoly_reptable(,%%ecx,4),%%ebx\n \
    jmp gpo_loc_0AB0\n \
# ---------------------------------------------------------------------------\n \
\n \
gpo_loc_0AA2:         # 8A7\n \
    movl    $0,%%edx\n \
    movl    $0x7FFFFFFF,%%eax\n \
    idivl   %%ecx\n \
    movl    %%eax,%%ebx\n \
\n \
gpo_loc_0AB0:         # 8B0\n \
    movl    _gploc_pt_bs,%%eax\n \
    subl    _gploc_pt_as,%%eax\n \
    shll    $1,%%eax\n \
    imull   %%ebx\n \
    movw    %%dx,%%ax\n \
    roll    $0x10,%%eax\n \
    jns gpo_loc_0AC5\n \
    incl    %%eax\n \
\n \
gpo_loc_0AC5:         # 8D2\n \
    movl    %%eax,_gploc_point_c\n \
    movl    _gploc_pt_bu,%%eax\n \
    subl    _gploc_pt_au,%%eax\n \
    shll    $1,%%eax\n \
    imull   %%ebx\n \
    movw    %%dx,%%ax\n \
    roll    $0x10,%%eax\n \
    jns gpo_loc_0ADE\n \
    incl    %%eax\n \
\n \
gpo_loc_0ADE:         # 8EB\n \
    movl    %%eax,_mapxveltop\n \
    movl    _gploc_pt_bv,%%eax\n \
    subl    _gploc_pt_av,%%eax\n \
    shll    $1,%%eax\n \
    imull   %%ebx\n \
    movw    %%dx,%%ax\n \
    roll    $0x10,%%eax\n \
    jns gpo_loc_0AF7\n \
    incl    %%eax\n \
\n \
gpo_loc_0AF7:         # 90\n \
    movl    %%eax,_mapyveltop\n \
    movl    _gploc_pt_cy,%%ecx\n \
    subl    _gploc_pt_by,%%ecx\n \
    cmpl    $0x0FF,%%ecx\n \
    jg  gpo_loc_0B14\n \
    movl    _gpoly_reptable(,%%ecx,4),%%ebx\n \
    jmp gpo_loc_0B22\n \
# ---------------------------------------------------------------------------\n \
\n \
gpo_loc_0B14:         # 91\n \
    movl    $0,%%edx\n \
    movl    $0x7FFFFFFF,%%eax\n \
    idivl   %%ecx\n \
    movl    %%eax,%%ebx\n \
\n \
gpo_loc_0B22:         # 922\n \
    movl    _gploc_pt_cs,%%eax\n \
    subl    _gploc_pt_bs,%%eax\n \
    shll    $1,%%eax\n \
    imull   %%ebx\n \
    movw    %%dx,%%ax\n \
    roll    $0x10,%%eax\n \
    jns gpo_loc_0B37\n \
    incl    %%eax\n \
\n \
gpo_loc_0B37:         # 94\n \
    movl    %%eax,_gploc_1A0\n \
    movl    _gploc_pt_cu,%%eax\n \
    subl    _gploc_pt_bu,%%eax\n \
    shll    $1,%%eax\n \
    imull   %%ebx\n \
    movw    %%dx,%%ax\n \
    roll    $0x10,%%eax\n \
    jns gpo_loc_0B50\n \
    incl    %%eax\n \
\n \
gpo_loc_0B50:         # 95D\n \
    movl    %%eax,_gploc_198\n \
    movl    _gploc_pt_cv,%%eax\n \
    subl    _gploc_pt_bv,%%eax\n \
    shll    $1,%%eax\n \
    imull   %%ebx\n \
    movw    %%dx,%%ax\n \
    roll    $0x10,%%eax\n \
    jns gpo_loc_0B69\n \
    incl    %%eax\n \
\n \
gpo_loc_0B69:         # 976\n \
    movl    %%eax,_gploc_18C\n \
    movl    _gploc_point_a,%%eax\n \
    movl    _mapxhstep,%%ebx\n \
    imull   %%ebx\n \
    movw    %%dx,%%ax\n \
    roll    $0x10,%%eax\n \
    subl    %%eax,_mapxveltop\n \
    movl    _gploc_point_a,%%eax\n \
    movl    _mapyhstep,%%ebx\n \
    imull   %%ebx\n \
    movw    %%dx,%%ax\n \
    roll    $0x10,%%eax\n \
    subl    %%eax,_mapyveltop\n \
    movl    _gploc_point_a,%%eax\n \
    movl    _shadehstep,%%ebx\n \
    imull   %%ebx\n \
    movw    %%dx,%%ax\n \
    roll    $0x10,%%eax\n \
    subl    %%eax,_gploc_point_c\n \
    movl    _gploc_point_b,%%eax\n \
    movl    _mapxhstep,%%ebx\n \
    imull   %%ebx\n \
    movw    %%dx,%%ax\n \
    roll    $0x10,%%eax\n \
    subl    %%eax,_gploc_198\n \
    movl    _gploc_point_b,%%eax\n \
    movl    _mapyhstep,%%ebx\n \
    imull   %%ebx\n \
    movw    %%dx,%%ax\n \
    roll    $0x10,%%eax\n \
    subl    %%eax,_gploc_18C\n \
    movl    _gploc_point_b,%%eax\n \
    movl    _shadehstep,%%ebx\n \
    imull   %%ebx\n \
    movw    %%dx,%%ax\n \
    roll    $0x10,%%eax\n \
    subl    %%eax,_gploc_1A0\n \
    jmp gpo_loc_0CB0\n \
# ---------------------------------------------------------------------------\n \
\n \
gpo_loc_0BFC:         # 893\n \
    movl    _gploc_pt_cy,%%ecx\n \
    subl    _gploc_pt_ay,%%ecx\n \
    cmpl    $0x0FF,%%ecx\n \
    jg  gpo_loc_0C15\n \
    movl    _gpoly_reptable(,%%ecx,4),%%ebx\n \
    jmp gpo_loc_0C23\n \
# ---------------------------------------------------------------------------\n \
\n \
gpo_loc_0C15:         # A1A\n \
    movl    $0,%%edx\n \
    movl    $0x7FFFFFFF,%%eax\n \
    idivl   %%ecx\n \
    movl    %%eax,%%ebx\n \
\n \
gpo_loc_0C23:         # A23\n \
    movl    _gploc_pt_cs,%%eax\n \
    subl    _gploc_pt_as,%%eax\n \
    shll    $1,%%eax\n \
    imull   %%ebx\n \
    movw    %%dx,%%ax\n \
    roll    $0x10,%%eax\n \
    jns gpo_loc_0C38\n \
    incl    %%eax\n \
\n \
gpo_loc_0C38:         # A45\n \
    movl    %%eax,_gploc_point_c\n \
    movl    _gploc_pt_cu,%%eax\n \
    subl    _gploc_pt_au,%%eax\n \
    shll    $1,%%eax\n \
    imull   %%ebx\n \
    movw    %%dx,%%ax\n \
    roll    $0x10,%%eax\n \
    jns gpo_loc_0C51\n \
    incl    %%eax\n \
\n \
gpo_loc_0C51:         # A5E\n \
    movl    %%eax,_mapxveltop\n \
    movl    _gploc_pt_cv,%%eax\n \
    subl    _gploc_pt_av,%%eax\n \
    shll    $1,%%eax\n \
    imull   %%ebx\n \
    movw    %%dx,%%ax\n \
    roll    $0x10,%%eax\n \
    jns gpo_loc_0C6A\n \
    incl    %%eax\n \
\n \
gpo_loc_0C6A:         # A77\n \
    movl    %%eax,_mapyveltop\n \
    movl    _factor_ca,%%eax\n \
    movl    _mapxhstep,%%ebx\n \
    imull   %%ebx\n \
    movw    %%dx,%%ax\n \
    roll    $0x10,%%eax\n \
    subl    %%eax,_mapxveltop\n \
    movl    _factor_ca,%%eax\n \
    movl    _mapyhstep,%%ebx\n \
    imull   %%ebx\n \
    movw    %%dx,%%ax\n \
    roll    $0x10,%%eax\n \
    subl    %%eax,_mapyveltop\n \
    movl    _factor_ca,%%eax\n \
    movl    _shadehstep,%%ebx\n \
    imull   %%ebx\n \
    movw    %%dx,%%ax\n \
    roll    $0x10,%%eax\n \
    subl    %%eax,_gploc_point_c\n \
\n \
gpo_loc_0CB0:         # A07\n \
    popa    \n \
" : : : "memory", "cc");
#endif
}

void draw_gpoly_sub2c()
{
    startposshadetop = (gploc_pt_as << 16) + shadehstep;
    startposmapxtop = (gploc_pt_au << 16) + mapxhstep;
    startposmapytop = (gploc_pt_av << 16) + mapyhstep;
    startposshadebottom = (gploc_pt_bs << 16) + shadehstep;
    startposmapxbottom = (gploc_pt_bu << 16) + mapxhstep;
    startposmapybottom = (gploc_pt_bv << 16) + mapyhstep;

    unk_update_gpoly1_tri16a(&gploc_B8, &gploc_BC, gploc_word03, mapxhstep, 65536);
    unk_update_gpoly1_tri8a(&gploc_B4, &gploc_B8, gploc_B8, mapyhstep, 256);
    unk_update_gpoly1_tri16a(&gploc_2C, &gploc_5C, gploc_word03, mapxhstep, 65535);
    unk_update_gpoly1_tri8a(&gploc_28, &gploc_2C, gploc_2C, mapyhstep, 256);
    unk_update_gpoly1_tri16a(&gploc_A0, &gploc_A4, gploc_word01, mapxveltop, 65536);
    unk_update_gpoly1_tri8a(&gploc_9C, &gploc_A0, gploc_A0, mapyveltop, 256);
    unk_update_gpoly1_tri16b(&gploc_84, &gploc_88, &gploc_8C, startposmapytop, startposmapxtop, startposshadetop);

    if ( factor_chk >= 0 )
    {
        unk_update_gpoly1_tri16a(&gploc_94, &gploc_98, gploc_word02, gploc_198, 65536);
        unk_update_gpoly1_tri8a(&gploc_90, &gploc_94, gploc_94, gploc_18C, 256);
        unk_update_gpoly1_tri16b(&gploc_78, &gploc_7C, &gploc_80, startposmapybottom, startposmapxbottom, startposshadebottom);
    }

}

void draw_gpoly_sub3a()
{
#if __GNUC__
    asm volatile (" \
    pusha   \n \
    movl    _gploc_pt_bx,%%esi\n \
    movl    _factor_chk,%%edi\n \
    orl %%edi,%%edi\n \
    subl    $0,%%esi\n \
    addl    $0,%%esi\n \
    movl    _gploc_pt_ax,%%eax\n \
    subl    %%eax,%%esi\n \
    movl    _gploc_pt_cx,%%edi\n \
    subl    %%eax,%%edi\n \
    movl    _gploc_pt_ay,%%eax\n \
    movl    _gploc_pt_by,%%ebx\n \
    subl    %%eax,%%ebx\n \
    movl    _gploc_pt_cy,%%ecx\n \
    subl    %%eax,%%ecx\n \
    movl    %%ecx,%%eax\n \
    imull   %%esi,%%ecx\n \
    movl    _factor_chk,%%ebp\n \
    orl %%ebp,%%ebp\n \
    js  gpo_loc_0FAC\n \
    subl    %%eax,%%ecx\n \
    subl    %%eax,%%ecx\n \
\n \
gpo_loc_0FAC:         # DB6\n \
    addl    %%eax,%%ecx\n \
    imull   %%edi,%%ebx\n \
    subl    %%ecx,%%ebx\n \
    jz  gpo_loc_1002\n \
    xorl    %%edx,%%edx\n \
    movl    $0x7FFFFFFF,%%eax\n \
    idivl   %%ebx\n \
    movl    %%eax,%%ebp\n \
    movl    _gploc_pt_ay,%%eax\n \
    movl    _gploc_pt_cy,%%esi\n \
    subl    %%eax,%%esi\n \
    movl    _gploc_pt_by,%%edi\n \
    subl    %%eax,%%edi\n \
    movl    %%ebp,%%eax\n \
    movl    _gploc_pt_as,%%edx\n \
    movl    _gploc_pt_cs,%%ebx\n \
    subl    %%edx,%%ebx\n \
    movl    _gploc_pt_bs,%%ecx\n \
    subl    %%edx,%%ecx\n \
    imull   %%esi,%%ecx\n \
    imull   %%edi,%%ebx\n \
    subl    %%ecx,%%ebx\n \
    imull   %%ebx\n \
    shll    $1,%%eax\n \
    rcll    $1,%%edx\n \
    movw    %%dx,%%ax\n \
    roll    $0x10,%%eax\n \
    jns gpo_loc_0FF9\n \
    incl    %%eax\n \
\n \
gpo_loc_0FF9:         # E06\n \
    movl    %%eax,_shadehstep\n \
    jmp gpo_loc_100B\n \
# ---------------------------------------------------------------------------\n \
\n \
gpo_loc_1002:         # DC3\n \
    xorl    %%eax,%%eax\n \
    movl    %%eax,_shadehstep\n \
\n \
gpo_loc_100B:         # E10\n \
    popa    \n \
" : : : "memory", "cc");
#endif
}

void draw_gpoly_sub3b()
{
#if __GNUC__
    asm volatile (" \
    pusha   \n \
    movl    _factor_chk,%%esi\n \
    orl %%esi,%%esi\n \
    js  gpo_loc_1099\n \
    movl    _gploc_pt_by,%%ecx\n \
    subl    _gploc_pt_ay,%%ecx\n \
    cmpl    $0x0FF,%%ecx\n \
    jg  gpo_loc_1030\n \
    movl    _gpoly_reptable(,%%ecx,4),%%ebx\n \
    jmp gpo_loc_103E\n \
# ---------------------------------------------------------------------------\n \
\n \
gpo_loc_1030:         # E35\n \
    movl    $0,%%edx\n \
    movl    $0x7FFFFFFF,%%eax\n \
    idivl   %%ecx\n \
    movl    %%eax,%%ebx\n \
\n \
gpo_loc_103E:         # E3E\n \
    movl    _gploc_pt_bs,%%eax\n \
    subl    _gploc_pt_as,%%eax\n \
    shll    $1,%%eax\n \
    imull   %%ebx\n \
    movw    %%dx,%%ax\n \
    roll    $0x10,%%eax\n \
    jns gpo_loc_1053\n \
    incl    %%eax\n \
\n \
gpo_loc_1053:         # E60\n \
    movl    %%eax,_gploc_point_c\n \
    movl    _gploc_pt_cy,%%ecx\n \
    subl    _gploc_pt_by,%%ecx\n \
    cmpl    $0x0FF,%%ecx\n \
    jg  gpo_loc_1070\n \
    movl    _gpoly_reptable(,%%ecx,4),%%ebx\n \
    jmp gpo_loc_107E\n \
# ---------------------------------------------------------------------------\n \
\n \
gpo_loc_1070:         # E75\n \
    movl    $0,%%edx\n \
    movl    $0x7FFFFFFF,%%eax\n \
    idivl   %%ecx\n \
    movl    %%eax,%%ebx\n \
\n \
gpo_loc_107E:         # E7E\n \
    movl    _gploc_pt_cs,%%eax\n \
    subl    _gploc_pt_bs,%%eax\n \
    shll    $1,%%eax\n \
    imull   %%ebx\n \
    movw    %%dx,%%ax\n \
    roll    $0x10,%%eax\n \
    jns gpo_loc_1093\n \
    incl    %%eax\n \
\n \
gpo_loc_1093:         # EA0\n \
    movl    %%eax,_gploc_1A0\n \
    jmp gpo_loc_10D9\n \
# ---------------------------------------------------------------------------\n \
\n \
gpo_loc_1099:         # E2\n \
    movl    _gploc_pt_cy,%%ecx\n \
    subl    _gploc_pt_ay,%%ecx\n \
    cmpl    $0x0FF,%%ecx\n \
    jg  gpo_loc_10B2\n \
    movl    _gpoly_reptable(,%%ecx,4),%%ebx\n \
    jmp gpo_loc_10C0\n \
# ---------------------------------------------------------------------------\n \
\n \
gpo_loc_10B2:         # EB7\n \
    movl    $0,%%edx\n \
    movl    $0x7FFFFFFF,%%eax\n \
    idivl   %%ecx\n \
    movl    %%eax,%%ebx\n \
\n \
gpo_loc_10C0:         # EC0\n \
    movl    _gploc_pt_cs,%%eax\n \
    subl    _gploc_pt_as,%%eax\n \
    shll    $1,%%eax\n \
    imull   %%ebx\n \
    movw    %%dx,%%ax\n \
    roll    $0x10,%%eax\n \
    jns gpo_loc_10D5\n \
    incl    %%eax\n \
\n \
gpo_loc_10D5:         # EE2\n \
    movl    %%eax,_gploc_point_c\n \
\n \
gpo_loc_10D9:         # EA7\n \
    movl    _gploc_pt_as,%%eax\n \
    shll    $0x10,%%eax\n \
    movl    %%eax,_startposshadetop\n \
    movl    _gploc_pt_bs,%%eax\n \
    shll    $0x10,%%eax\n \
    movl    %%eax,_startposshadebottom\n \
    popa    \n \
" : : : "memory", "cc");
#endif
}

void draw_gpoly_sub4()
{
#if __GNUC__
    asm volatile (" \
    pusha   \n \
    movl    _gploc_pt_bx,%%esi\n \
    movl    _factor_chk,%%edi\n \
    orl %%edi,%%edi\n \
    subl    $0,%%esi\n \
    addl    $0,%%esi\n \
    movl    _gploc_pt_ax,%%eax\n \
    subl    %%eax,%%esi\n \
    movl    _gploc_pt_cx,%%edi\n \
    subl    %%eax,%%edi\n \
    movl    _gploc_pt_ay,%%eax\n \
    movl    _gploc_pt_by,%%ebx\n \
    subl    %%eax,%%ebx\n \
    movl    _gploc_pt_cy,%%ecx\n \
    subl    %%eax,%%ecx\n \
    movl    %%ecx,%%eax\n \
    imull   %%esi,%%ecx\n \
    movl    _factor_chk,%%ebp\n \
    orl %%ebp,%%ebp\n \
    js  gpo_loc_1137\n \
    subl    %%eax,%%ecx\n \
    subl    %%eax,%%ecx\n \
\n \
gpo_loc_1137:         # F4\n \
    addl    %%eax,%%ecx\n \
    imull   %%edi,%%ebx\n \
    subl    %%ecx,%%ebx\n \
    jz  gpo_loc_11BD\n \
    xorl    %%edx,%%edx\n \
    movl    $0x7FFFFFFF,%%eax\n \
    idivl   %%ebx\n \
    movl    %%eax,%%ebp\n \
    movl    _gploc_pt_ay,%%eax\n \
    movl    _gploc_pt_cy,%%esi\n \
    subl    %%eax,%%esi\n \
    movl    _gploc_pt_by,%%edi\n \
    subl    %%eax,%%edi\n \
    movl    %%ebp,%%eax\n \
    movl    _gploc_pt_au,%%edx\n \
    movl    _gploc_pt_cu,%%ebx\n \
    subl    %%edx,%%ebx\n \
    movl    _gploc_pt_bu,%%ecx\n \
    subl    %%edx,%%ecx\n \
    imull   %%esi,%%ecx\n \
    imull   %%edi,%%ebx\n \
    subl    %%ecx,%%ebx\n \
    imull   %%ebx\n \
    shll    $1,%%eax\n \
    rcll    $1,%%edx\n \
    movw    %%dx,%%ax\n \
    roll    $0x10,%%eax\n \
    jns gpo_loc_1184\n \
    incl    %%eax\n \
\n \
gpo_loc_1184:         # F9\n \
    movl    %%eax,_mapxhstep\n \
    movl    %%ebp,%%eax\n \
    movl    _gploc_pt_av,%%edx\n \
    movl    _gploc_pt_cv,%%ebx\n \
    subl    %%edx,%%ebx\n \
    movl    _gploc_pt_bv,%%ecx\n \
    subl    %%edx,%%ecx\n \
    imull   %%esi,%%ecx\n \
    imull   %%edi,%%ebx\n \
    subl    %%ecx,%%ebx\n \
    imull   %%ebx\n \
    shll    $1,%%eax\n \
    rcll    $1,%%edx\n \
    movw    %%dx,%%ax\n \
    roll    $0x10,%%eax\n \
    jns gpo_loc_11B4\n \
    incl    %%eax\n \
\n \
gpo_loc_11B4:         # FC\n \
    movl    %%eax,_mapyhstep\n \
    jmp gpo_loc_11CD\n \
# ---------------------------------------------------------------------------\n \
\n \
gpo_loc_11BD:         # F4E\n \
    xorl    %%eax,%%eax\n \
    movl    %%eax,_mapxhstep\n \
    movl    %%eax,_mapyhstep\n \
\n \
gpo_loc_11CD:         # FCB\n \
    popa    \n \
" : : : "memory", "cc");
#endif

#if __GNUC__
    asm volatile (" \
    pusha   \n \
    movl    _factor_chk,%%esi\n \
    orl %%esi,%%esi\n \
    js  gpo_loc_128D\n \
    movl    _gploc_pt_by,%%ecx\n \
    subl    _gploc_pt_ay,%%ecx\n \
    cmpl    $0x0FF,%%ecx\n \
    jg  gpo_loc_11F2\n \
    movl    _gpoly_reptable(,%%ecx,4),%%ebx\n \
    jmp gpo_loc_1200\n \
# ---------------------------------------------------------------------------\n \
\n \
gpo_loc_11F2:         # FF7\n \
    movl    $0,%%edx\n \
    movl    $0x7FFFFFFF,%%eax\n \
    idivl   %%ecx\n \
    movl    %%eax,%%ebx\n \
\n \
gpo_loc_1200:         # 1000\n \
    movl    _gploc_pt_bu,%%eax\n \
    subl    _gploc_pt_au,%%eax\n \
    shll    $1,%%eax\n \
    imull   %%ebx\n \
    movw    %%dx,%%ax\n \
    roll    $0x10,%%eax\n \
    jns gpo_loc_1215\n \
    incl    %%eax\n \
\n \
gpo_loc_1215:         # 1022\n \
    movl    %%eax,_mapxveltop\n \
    movl    _gploc_pt_bv,%%eax\n \
    subl    _gploc_pt_av,%%eax\n \
    shll    $1,%%eax\n \
    imull   %%ebx\n \
    movw    %%dx,%%ax\n \
    roll    $0x10,%%eax\n \
    jns gpo_loc_122E\n \
    incl    %%eax\n \
\n \
gpo_loc_122E:         # 103B\n \
    movl    %%eax,_mapyveltop\n \
    movl    _gploc_pt_cy,%%ecx\n \
    subl    _gploc_pt_by,%%ecx\n \
    cmpl    $0x0FF,%%ecx\n \
    jg  gpo_loc_124B\n \
    movl    _gpoly_reptable(,%%ecx,4),%%ebx\n \
    jmp gpo_loc_1259\n \
# ---------------------------------------------------------------------------\n \
\n \
gpo_loc_124B:         # 1050\n \
    movl    $0,%%edx\n \
    movl    $0x7FFFFFFF,%%eax\n \
    idivl   %%ecx\n \
    movl    %%eax,%%ebx\n \
\n \
gpo_loc_1259:         # 105\n \
    movl    _gploc_pt_cu,%%eax\n \
    subl    _gploc_pt_bu,%%eax\n \
    shll    $1,%%eax\n \
    imull   %%ebx\n \
    movw    %%dx,%%ax\n \
    roll    $0x10,%%eax\n \
    jns gpo_loc_126E\n \
    incl    %%eax\n \
\n \
gpo_loc_126E:         # 107B\n \
    movl    %%eax,_gploc_198\n \
    movl    _gploc_pt_cv,%%eax\n \
    subl    _gploc_pt_bv,%%eax\n \
    shll    $1,%%eax\n \
    imull   %%ebx\n \
    movw    %%dx,%%ax\n \
    roll    $0x10,%%eax\n \
    jns gpo_loc_1287\n \
    incl    %%eax\n \
\n \
gpo_loc_1287:         # 109\n \
    movl    %%eax,_gploc_18C\n \
    jmp gpo_loc_12E6\n \
# ---------------------------------------------------------------------------\n \
\n \
gpo_loc_128D:         # FE3\n \
    movl    _gploc_pt_cy,%%ecx\n \
    subl    _gploc_pt_ay,%%ecx\n \
    cmpl    $0x0FF,%%ecx\n \
    jg  gpo_loc_12A6\n \
    movl    _gpoly_reptable(,%%ecx,4),%%ebx\n \
    jmp gpo_loc_12B4\n \
# ---------------------------------------------------------------------------\n \
\n \
gpo_loc_12A6:         # 10AB\n \
    movl    $0,%%edx\n \
    movl    $0x7FFFFFFF,%%eax\n \
    idivl   %%ecx\n \
    movl    %%eax,%%ebx\n \
\n \
gpo_loc_12B4:         # 10B\n \
    movl    _gploc_pt_cu,%%eax\n \
    subl    _gploc_pt_au,%%eax\n \
    shll    $1,%%eax\n \
    imull   %%ebx\n \
    movw    %%dx,%%ax\n \
    roll    $0x10,%%eax\n \
    jns gpo_loc_12C9\n \
    incl    %%eax\n \
\n \
gpo_loc_12C9:         # 10D6\n \
    movl    %%eax,_mapxveltop\n \
    movl    _gploc_pt_cv,%%eax\n \
    subl    _gploc_pt_av,%%eax\n \
    shll    $1,%%eax\n \
    imull   %%ebx\n \
    movw    %%dx,%%ax\n \
    roll    $0x10,%%eax\n \
    jns gpo_loc_12E2\n \
    incl    %%eax\n \
\n \
gpo_loc_12E2:         # 10E\n \
    movl    %%eax,_mapyveltop\n \
\n \
gpo_loc_12E6:         # 109B\n \
    movl    _gploc_pt_au,%%eax\n \
    shll    $0x10,%%eax\n \
    movl    %%eax,_startposmapxtop\n \
    movl    _gploc_pt_av,%%eax\n \
    shll    $0x10,%%eax\n \
    movl    %%eax,_startposmapytop\n \
    movl    _gploc_pt_bu,%%eax\n \
    shll    $0x10,%%eax\n \
    movl    %%eax,_startposmapxbottom\n \
    movl    _gploc_pt_bv,%%eax\n \
    shll    $0x10,%%eax\n \
    movl    %%eax,_startposmapybottom\n \
    movl    _mapxhstep,%%eax\n \
    movl    %%eax,%%edx\n \
    shll    $0x10,%%eax\n \
    sarl    $0x10,%%edx\n \
    movl    %%eax,_gploc_BC\n \
    movl    %%edx,_gploc_B8\n \
    movl    _mapyhstep,%%eax\n \
    shll    $0x10,%%eax\n \
    movl    _mapyhstep,%%edx\n \
    sarl    $0x10,%%edx\n \
    movb    _gploc_B8,%%al\n \
    orb %%al,%%al\n \
    jns gpo_loc_1362\n \
    subl    $0x100,%%eax\n \
    sbbb    $0,%%dl\n \
\n \
gpo_loc_1362:         # 1168\n \
    movl    %%eax,_gploc_B8\n \
    movl    %%edx,_gploc_B4\n \
    movl    _mapxveltop,%%eax\n \
    movl    %%eax,%%edx\n \
    shll    $0x10,%%eax\n \
    sarl    $0x10,%%edx\n \
    movl    %%eax,_gploc_A4\n \
    movl    %%edx,_gploc_A0\n \
    movl    _mapyveltop,%%eax\n \
    shll    $0x10,%%eax\n \
    movl    _mapyveltop,%%edx\n \
    sarl    $0x10,%%edx\n \
    movb    _gploc_A0,%%al\n \
    orb %%al,%%al\n \
    jns gpo_loc_13AB\n \
    subl    $0x100,%%eax\n \
    sbbb    $0,%%dl\n \
\n \
gpo_loc_13AB:         # 11B\n \
    movl    %%eax,_gploc_A0\n \
    movl    %%edx,_gploc_9C\n \
    movl    _startposmapxtop,%%ecx\n \
    movl    _startposmapytop,%%edx\n \
    movl    %%ecx,%%eax\n \
    shll    $0x10,%%ecx\n \
    shrl    $0x10,%%eax\n \
    movl    %%ecx,_gploc_8C\n \
    movl    %%edx,%%ecx\n \
    shll    $0x10,%%ecx\n \
    shll    $8,%%edx\n \
    shrl    $0x18,%%edx\n \
    shll    $8,%%edx\n \
    movb    %%al,%%cl\n \
    movl    %%ecx,_gploc_88\n \
    movl    %%edx,_gploc_84\n \
    movl    _factor_chk,%%esi\n \
    orl %%esi,%%esi\n \
    js  gpo_loc_1484\n \
    movl    _gploc_198,%%eax\n \
    movl    %%eax,%%edx\n \
    shll    $0x10,%%eax\n \
    sarl    $0x10,%%edx\n \
    movl    %%eax,_gploc_98\n \
    movl    %%edx,_gploc_94\n \
    movl    _gploc_18C,%%eax\n \
    shll    $0x10,%%eax\n \
    movl    _gploc_18C,%%edx\n \
    sarl    $0x10,%%edx\n \
    movb    _gploc_94,%%al\n \
    orb %%al,%%al\n \
    jns gpo_loc_143B\n \
    subl    $0x100,%%eax\n \
    sbbb    $0,%%dl\n \
\n \
gpo_loc_143B:         # 124\n \
    movl    %%eax,_gploc_94\n \
    movl    %%edx,_gploc_90\n \
    movl    _startposmapxbottom,%%ecx\n \
    movl    _startposmapybottom,%%edx\n \
    movl    %%ecx,%%eax\n \
    shll    $0x10,%%ecx\n \
    shrl    $0x10,%%eax\n \
    movl    %%ecx,_gploc_80\n \
    movl    %%edx,%%ecx\n \
    shll    $0x10,%%ecx\n \
    shll    $8,%%edx\n \
    shrl    $0x18,%%edx\n \
    shll    $8,%%edx\n \
    movb    %%al,%%cl\n \
    movl    %%ecx,_gploc_7C\n \
    movl    %%edx,_gploc_78\n \
\n \
gpo_loc_1484:         # 120A\n \
    popa    \n \
" : : : "memory", "cc");
#endif
}

void draw_gpoly_sub5()
{
#if __GNUC__
    asm volatile (" \
    pusha   \n \
    movl    _gploc_pt_bx,%%esi\n \
    movl    _factor_chk,%%edi\n \
    orl %%edi,%%edi\n \
    subl    $0,%%esi\n \
    addl    $0,%%esi\n \
    movl    _gploc_pt_ax,%%eax\n \
    subl    %%eax,%%esi\n \
    movl    _gploc_pt_cx,%%edi\n \
    subl    %%eax,%%edi\n \
    movl    _gploc_pt_ay,%%eax\n \
    movl    _gploc_pt_by,%%ebx\n \
    subl    %%eax,%%ebx\n \
    movl    _gploc_pt_cy,%%ecx\n \
    subl    %%eax,%%ecx\n \
    movl    %%ecx,%%eax\n \
    imull   %%esi,%%ecx\n \
    movl    _factor_chk,%%ebp\n \
    orl %%ebp,%%ebp\n \
    js  gpo_loc_14C6\n \
    subl    %%eax,%%ecx\n \
    subl    %%eax,%%ecx\n \
\n \
gpo_loc_14C6:         # 12D0\n \
    addl    %%eax,%%ecx\n \
    imull   %%edi,%%ebx\n \
    subl    %%ecx,%%ebx\n \
    jz  gpo_loc_154C\n \
    xorl    %%edx,%%edx\n \
    movl    $0x7FFFFFFF,%%eax\n \
    idivl   %%ebx\n \
    movl    %%eax,%%ebp\n \
    movl    _gploc_pt_ay,%%eax\n \
    movl    _gploc_pt_cy,%%esi\n \
    subl    %%eax,%%esi\n \
    movl    _gploc_pt_by,%%edi\n \
    subl    %%eax,%%edi\n \
    movl    %%ebp,%%eax\n \
    movl    _gploc_pt_au,%%edx\n \
    movl    _gploc_pt_cu,%%ebx\n \
    subl    %%edx,%%ebx\n \
    movl    _gploc_pt_bu,%%ecx\n \
    subl    %%edx,%%ecx\n \
    imull   %%esi,%%ecx\n \
    imull   %%edi,%%ebx\n \
    subl    %%ecx,%%ebx\n \
    imull   %%ebx\n \
    shll    $1,%%eax\n \
    rcll    $1,%%edx\n \
    movw    %%dx,%%ax\n \
    roll    $0x10,%%eax\n \
    jns gpo_loc_1513\n \
    incl    %%eax\n \
\n \
gpo_loc_1513:         # 1320\n \
    movl    %%eax,_mapxhstep\n \
    movl    %%ebp,%%eax\n \
    movl    _gploc_pt_av,%%edx\n \
    movl    _gploc_pt_cv,%%ebx\n \
    subl    %%edx,%%ebx\n \
    movl    _gploc_pt_bv,%%ecx\n \
    subl    %%edx,%%ecx\n \
    imull   %%esi,%%ecx\n \
    imull   %%edi,%%ebx\n \
    subl    %%ecx,%%ebx\n \
    imull   %%ebx\n \
    shll    $1,%%eax\n \
    rcll    $1,%%edx\n \
    movw    %%dx,%%ax\n \
    roll    $0x10,%%eax\n \
    jns gpo_loc_1543\n \
    incl    %%eax\n \
\n \
gpo_loc_1543:         # 1350\n \
    movl    %%eax,_mapyhstep\n \
    jmp gpo_loc_155C\n \
# ---------------------------------------------------------------------------\n \
\n \
gpo_loc_154C:         # 12DD\n \
    xorl    %%eax,%%eax\n \
    movl    %%eax,_mapxhstep\n \
    movl    %%eax,_mapyhstep\n \
\n \
gpo_loc_155C:         # 135A\n \
    popa    \n \
" : : : "memory", "cc");
#endif

#if __GNUC__
    asm volatile (" \
    pusha   \n \
    movl    _factor_chk,%%esi\n \
    orl %%esi,%%esi\n \
    js  gpo_loc_161C\n \
    movl    _gploc_pt_by,%%ecx\n \
    subl    _gploc_pt_ay,%%ecx\n \
    cmpl    $0x0FF,%%ecx\n \
    jg  gpo_loc_1581\n \
    movl    _gpoly_reptable(,%%ecx,4),%%ebx\n \
    jmp gpo_loc_158F\n \
# ---------------------------------------------------------------------------\n \
\n \
gpo_loc_1581:         # 1386\n \
    movl    $0,%%edx\n \
    movl    $0x7FFFFFFF,%%eax\n \
    idivl   %%ecx\n \
    movl    %%eax,%%ebx\n \
\n \
gpo_loc_158F:         # 138\n \
    movl    _gploc_pt_bu,%%eax\n \
    subl    _gploc_pt_au,%%eax\n \
    shll    $1,%%eax\n \
    imull   %%ebx\n \
    movw    %%dx,%%ax\n \
    roll    $0x10,%%eax\n \
    jns gpo_loc_15A4\n \
    incl    %%eax\n \
\n \
gpo_loc_15A4:         # 13B\n \
    movl    %%eax,_mapxveltop\n \
    movl    _gploc_pt_bv,%%eax\n \
    subl    _gploc_pt_av,%%eax\n \
    shll    $1,%%eax\n \
    imull   %%ebx\n \
    movw    %%dx,%%ax\n \
    roll    $0x10,%%eax\n \
    jns gpo_loc_15BD\n \
    incl    %%eax\n \
\n \
gpo_loc_15BD:         # 13CA\n \
    movl    %%eax,_mapyveltop\n \
    movl    _gploc_pt_cy,%%ecx\n \
    subl    _gploc_pt_by,%%ecx\n \
    cmpl    $0x0FF,%%ecx\n \
    jg  gpo_loc_15DA\n \
    movl    _gpoly_reptable(,%%ecx,4),%%ebx\n \
    jmp gpo_loc_15E8\n \
# ---------------------------------------------------------------------------\n \
\n \
gpo_loc_15DA:         # 13D\n \
    movl    $0,%%edx\n \
    movl    $0x7FFFFFFF,%%eax\n \
    idivl   %%ecx\n \
    movl    %%eax,%%ebx\n \
\n \
gpo_loc_15E8:         # 13E8\n \
    movl    _gploc_pt_cu,%%eax\n \
    subl    _gploc_pt_bu,%%eax\n \
    shll    $1,%%eax\n \
    imull   %%ebx\n \
    movw    %%dx,%%ax\n \
    roll    $0x10,%%eax\n \
    jns gpo_loc_15FD\n \
    incl    %%eax\n \
\n \
gpo_loc_15FD:         # 140A\n \
    movl    %%eax,_gploc_198\n \
    movl    _gploc_pt_cv,%%eax\n \
    subl    _gploc_pt_bv,%%eax\n \
    shll    $1,%%eax\n \
    imull   %%ebx\n \
    movw    %%dx,%%ax\n \
    roll    $0x10,%%eax\n \
    jns gpo_loc_1616\n \
    incl    %%eax\n \
\n \
gpo_loc_1616:         # 1423\n \
    movl    %%eax,_gploc_18C\n \
    jmp gpo_loc_1675\n \
# ---------------------------------------------------------------------------\n \
\n \
gpo_loc_161C:         # 1372\n \
    movl    _gploc_pt_cy,%%ecx\n \
    subl    _gploc_pt_ay,%%ecx\n \
    cmpl    $0x0FF,%%ecx\n \
    jg  gpo_loc_1635\n \
    movl    _gpoly_reptable(,%%ecx,4),%%ebx\n \
    jmp gpo_loc_1643\n \
# ---------------------------------------------------------------------------\n \
\n \
gpo_loc_1635:         # 143A\n \
    movl    $0,%%edx\n \
    movl    $0x7FFFFFFF,%%eax\n \
    idivl   %%ecx\n \
    movl    %%eax,%%ebx\n \
\n \
gpo_loc_1643:         # 1443\n \
    movl    _gploc_pt_cu,%%eax\n \
    subl    _gploc_pt_au,%%eax\n \
    shll    $1,%%eax\n \
    imull   %%ebx\n \
    movw    %%dx,%%ax\n \
    roll    $0x10,%%eax\n \
    jns gpo_loc_1658\n \
    incl    %%eax\n \
\n \
gpo_loc_1658:         # 1465\n \
    movl    %%eax,_mapxveltop\n \
    movl    _gploc_pt_cv,%%eax\n \
    subl    _gploc_pt_av,%%eax\n \
    shll    $1,%%eax\n \
    imull   %%ebx\n \
    movw    %%dx,%%ax\n \
    roll    $0x10,%%eax\n \
    jns gpo_loc_1671\n \
    incl    %%eax\n \
\n \
gpo_loc_1671:         # 147E\n \
    movl    %%eax,_mapyveltop\n \
\n \
gpo_loc_1675:         # 142A\n \
    movl    _gploc_pt_au,%%eax\n \
    shll    $0x10,%%eax\n \
    movl    %%eax,_startposmapxtop\n \
    movl    _gploc_pt_av,%%eax\n \
    shll    $0x10,%%eax\n \
    movl    %%eax,_startposmapytop\n \
    movl    _gploc_pt_bu,%%eax\n \
    shll    $0x10,%%eax\n \
    movl    %%eax,_startposmapxbottom\n \
    movl    _gploc_pt_bv,%%eax\n \
    shll    $0x10,%%eax\n \
    movl    %%eax,_startposmapybottom\n \
    movl    _mapyhstep,%%eax\n \
    movl    %%eax,%%edx\n \
    shll    $0x10,%%eax\n \
    movl    %%eax,_gploc_BC\n \
    movl    _mapxhstep,%%eax\n \
    orl %%edx,%%edx\n \
    jns gpo_loc_16CC\n \
    decl    %%eax\n \
\n \
gpo_loc_16CC:         # 14D\n \
    shll    $8,%%eax\n \
    shrl    $0x10,%%edx\n \
    andl    $0x0FF,%%edx\n \
    orl %%eax,%%edx\n \
    movl    %%edx,_gploc_B8\n \
    movl    _mapyveltop,%%eax\n \
    movl    %%eax,%%edx\n \
    shll    $0x10,%%eax\n \
    movl    %%eax,_gploc_A4\n \
    movl    _mapxveltop,%%eax\n \
    orl %%edx,%%edx\n \
    jns gpo_loc_16FA\n \
    decl    %%eax\n \
\n \
gpo_loc_16FA:         # 1507\n \
    shll    $8,%%eax\n \
    shrl    $0x10,%%edx\n \
    andl    $0x0FF,%%edx\n \
    orl %%eax,%%edx\n \
    movl    %%edx,_gploc_A0\n \
    movl    _startposmapytop,%%eax\n \
    movl    %%eax,%%edx\n \
    shll    $0x10,%%eax\n \
    movl    %%eax,_gploc_8C\n \
    movl    _startposmapxtop,%%eax\n \
    shll    $8,%%eax\n \
    shrl    $0x10,%%edx\n \
    andl    $0x0FF,%%edx\n \
    orl %%eax,%%edx\n \
    movl    %%edx,_gploc_88\n \
    movl    _factor_chk,%%esi\n \
    orl %%esi,%%esi\n \
    js  gpo_loc_17A3\n \
    movl    _gploc_18C,%%eax\n \
    movl    %%eax,%%edx\n \
    shll    $0x10,%%eax\n \
    movl    %%eax,_gploc_98\n \
    movl    _gploc_198,%%eax\n \
    orl %%edx,%%edx\n \
    jns gpo_loc_175F\n \
    decl    %%eax\n \
\n \
gpo_loc_175F:         # 156C\n \
    shll    $8,%%eax\n \
    shrl    $0x10,%%edx\n \
    andl    $0x0FF,%%edx\n \
    orl %%eax,%%edx\n \
    movl    %%edx,_gploc_94\n \
    movl    _startposmapybottom,%%eax\n \
    movl    %%eax,%%edx\n \
    shll    $0x10,%%eax\n \
    movl    %%eax,_gploc_80\n \
    movl    _startposmapxbottom,%%eax\n \
    shll    $8,%%eax\n \
    shrl    $0x10,%%edx\n \
    andl    $0x0FF,%%edx\n \
    orl %%eax,%%edx\n \
    movl    %%edx,_gploc_7C\n \
\n \
gpo_loc_17A3:         # 155\n \
    popa    \n \
" : : : "memory", "cc");
#endif
}

void draw_gpoly_sub6()
{
#if __GNUC__
    asm volatile (" \
    pusha   \n \
    movl    _gploc_pt_bx,%%esi\n \
    movl    _factor_chk,%%edi\n \
    orl %%edi,%%edi\n \
    subl    $0,%%esi\n \
    addl    $0,%%esi\n \
    movl    _gploc_pt_ax,%%eax\n \
    subl    %%eax,%%esi\n \
    movl    _gploc_pt_cx,%%edi\n \
    subl    %%eax,%%edi\n \
    movl    _gploc_pt_ay,%%eax\n \
    movl    _gploc_pt_by,%%ebx\n \
    subl    %%eax,%%ebx\n \
    movl    _gploc_pt_cy,%%ecx\n \
    subl    %%eax,%%ecx\n \
    movl    %%ecx,%%eax\n \
    imull   %%esi,%%ecx\n \
    movl    _factor_chk,%%ebp\n \
    orl %%ebp,%%ebp\n \
    js  gpo_loc_17E5\n \
    subl    %%eax,%%ecx\n \
    subl    %%eax,%%ecx\n \
\n \
gpo_loc_17E5:         # 15E\n \
    addl    %%eax,%%ecx\n \
    imull   %%edi,%%ebx\n \
    subl    %%ecx,%%ebx\n \
    jz  gpo_loc_189F\n \
    xorl    %%edx,%%edx\n \
    movl    $0x7FFFFFFF,%%eax\n \
    idivl   %%ebx\n \
    movl    %%eax,%%ebp\n \
    movl    _gploc_pt_ay,%%eax\n \
    movl    _gploc_pt_cy,%%esi\n \
    subl    %%eax,%%esi\n \
    movl    _gploc_pt_by,%%edi\n \
    subl    %%eax,%%edi\n \
    movl    %%ebp,%%eax\n \
    movl    _gploc_pt_as,%%edx\n \
    movl    _gploc_pt_cs,%%ebx\n \
    subl    %%edx,%%ebx\n \
    movl    _gploc_pt_bs,%%ecx\n \
    subl    %%edx,%%ecx\n \
    imull   %%esi,%%ecx\n \
    imull   %%edi,%%ebx\n \
    subl    %%ecx,%%ebx\n \
    imull   %%ebx\n \
    shll    $1,%%eax\n \
    rcll    $1,%%edx\n \
    movw    %%dx,%%ax\n \
    roll    $0x10,%%eax\n \
    jns gpo_loc_1836\n \
    incl    %%eax\n \
\n \
gpo_loc_1836:         # 1643\n \
    movl    %%eax,_shadehstep\n \
    movl    %%ebp,%%eax\n \
    movl    _gploc_pt_au,%%edx\n \
    movl    _gploc_pt_cu,%%ebx\n \
    subl    %%edx,%%ebx\n \
    movl    _gploc_pt_bu,%%ecx\n \
    subl    %%edx,%%ecx\n \
    imull   %%esi,%%ecx\n \
    imull   %%edi,%%ebx\n \
    subl    %%ecx,%%ebx\n \
    imull   %%ebx\n \
    shll    $1,%%eax\n \
    rcll    $1,%%edx\n \
    movw    %%dx,%%ax\n \
    roll    $0x10,%%eax\n \
    jns gpo_loc_1866\n \
    incl    %%eax\n \
\n \
gpo_loc_1866:         # 1673\n \
    movl    %%eax,_mapxhstep\n \
    movl    %%ebp,%%eax\n \
    movl    _gploc_pt_av,%%edx\n \
    movl    _gploc_pt_cv,%%ebx\n \
    subl    %%edx,%%ebx\n \
    movl    _gploc_pt_bv,%%ecx\n \
    subl    %%edx,%%ecx\n \
    imull   %%esi,%%ecx\n \
    imull   %%edi,%%ebx\n \
    subl    %%ecx,%%ebx\n \
    imull   %%ebx\n \
    shll    $1,%%eax\n \
    rcll    $1,%%edx\n \
    movw    %%dx,%%ax\n \
    roll    $0x10,%%eax\n \
    jns gpo_loc_1896\n \
    incl    %%eax\n \
\n \
gpo_loc_1896:         # 16A3\n \
    movl    %%eax,_mapyhstep\n \
    jmp gpo_loc_18B6\n \
# ---------------------------------------------------------------------------\n \
\n \
gpo_loc_189F:         # 15FC\n \
    xorl    %%eax,%%eax\n \
    movl    %%eax,_shadehstep\n \
    movl    %%eax,_mapxhstep\n \
    movl    %%eax,_mapyhstep\n \
\n \
gpo_loc_18B6:         # 16AD\n \
    popa    \n \
" : : : "memory", "cc");
#endif

#if __GNUC__
    asm volatile (" \
    pusha   \n \
    movl    _factor_chk,%%esi\n \
    orl %%esi,%%esi\n \
    js  gpo_loc_19A8\n \
    movl    _gploc_pt_by,%%ecx\n \
    subl    _gploc_pt_ay,%%ecx\n \
    cmpl    $0x0FF,%%ecx\n \
    jg  gpo_loc_18DB\n \
    movl    _gpoly_reptable(,%%ecx,4),%%ebx\n \
    jmp gpo_loc_18E9\n \
# ---------------------------------------------------------------------------\n \
\n \
gpo_loc_18DB:         # 16E0\n \
    movl    $0,%%edx\n \
    movl    $0x7FFFFFFF,%%eax\n \
    idivl   %%ecx\n \
    movl    %%eax,%%ebx\n \
\n \
gpo_loc_18E9:         # 16E\n \
    movl    _gploc_pt_bs,%%eax\n \
    subl    _gploc_pt_as,%%eax\n \
    shll    $1,%%eax\n \
    imull   %%ebx\n \
    movw    %%dx,%%ax\n \
    roll    $0x10,%%eax\n \
    jns gpo_loc_18FE\n \
    incl    %%eax\n \
\n \
gpo_loc_18FE:         # 170B\n \
    movl    %%eax,_gploc_point_c\n \
    movl    _gploc_pt_bu,%%eax\n \
    subl    _gploc_pt_au,%%eax\n \
    shll    $1,%%eax\n \
    imull   %%ebx\n \
    movw    %%dx,%%ax\n \
    roll    $0x10,%%eax\n \
    jns gpo_loc_1917\n \
    incl    %%eax\n \
\n \
gpo_loc_1917:         # 172\n \
    movl    %%eax,_mapxveltop\n \
    movl    _gploc_pt_bv,%%eax\n \
    subl    _gploc_pt_av,%%eax\n \
    shll    $1,%%eax\n \
    imull   %%ebx\n \
    movw    %%dx,%%ax\n \
    roll    $0x10,%%eax\n \
    jns gpo_loc_1930\n \
    incl    %%eax\n \
\n \
gpo_loc_1930:         # 173D\n \
    movl    %%eax,_mapyveltop\n \
    movl    _gploc_pt_cy,%%ecx\n \
    subl    _gploc_pt_by,%%ecx\n \
    cmpl    $0x0FF,%%ecx\n \
    jg  gpo_loc_194D\n \
    movl    _gpoly_reptable(,%%ecx,4),%%ebx\n \
    jmp gpo_loc_195B\n \
# ---------------------------------------------------------------------------\n \
\n \
gpo_loc_194D:         # 1752\n \
    movl    $0,%%edx\n \
    movl    $0x7FFFFFFF,%%eax\n \
    idivl   %%ecx\n \
    movl    %%eax,%%ebx\n \
\n \
gpo_loc_195B:         # 175B\n \
    movl    _gploc_pt_cs,%%eax\n \
    subl    _gploc_pt_bs,%%eax\n \
    shll    $1,%%eax\n \
    imull   %%ebx\n \
    movw    %%dx,%%ax\n \
    roll    $0x10,%%eax\n \
    jns gpo_loc_1970\n \
    incl    %%eax\n \
\n \
gpo_loc_1970:         # 177D\n \
    movl    %%eax,_gploc_1A0\n \
    movl    _gploc_pt_cu,%%eax\n \
    subl    _gploc_pt_bu,%%eax\n \
    shll    $1,%%eax\n \
    imull   %%ebx\n \
    movw    %%dx,%%ax\n \
    roll    $0x10,%%eax\n \
    jns gpo_loc_1989\n \
    incl    %%eax\n \
\n \
gpo_loc_1989:         # 1796\n \
    movl    %%eax,_gploc_198\n \
    movl    _gploc_pt_cv,%%eax\n \
    subl    _gploc_pt_bv,%%eax\n \
    shll    $1,%%eax\n \
    imull   %%ebx\n \
    movw    %%dx,%%ax\n \
    roll    $0x10,%%eax\n \
    jns gpo_loc_19A2\n \
    incl    %%eax\n \
\n \
gpo_loc_19A2:         # 17A\n \
    movl    %%eax,_gploc_18C\n \
    jmp gpo_loc_1A1A\n \
# ---------------------------------------------------------------------------\n \
\n \
gpo_loc_19A8:         # 16CC\n \
    movl    _gploc_pt_cy,%%ecx\n \
    subl    _gploc_pt_ay,%%ecx\n \
    cmpl    $0x0FF,%%ecx\n \
    jg  gpo_loc_19C1\n \
    movl    _gpoly_reptable(,%%ecx,4),%%ebx\n \
    jmp gpo_loc_19CF\n \
# ---------------------------------------------------------------------------\n \
\n \
gpo_loc_19C1:         # 17C6\n \
    movl    $0,%%edx\n \
    movl    $0x7FFFFFFF,%%eax\n \
    idivl   %%ecx\n \
    movl    %%eax,%%ebx\n \
\n \
gpo_loc_19CF:         # 17C\n \
    movl    _gploc_pt_cs,%%eax\n \
    subl    _gploc_pt_as,%%eax\n \
    shll    $1,%%eax\n \
    imull   %%ebx\n \
    movw    %%dx,%%ax\n \
    roll    $0x10,%%eax\n \
    jns gpo_loc_19E4\n \
    incl    %%eax\n \
\n \
gpo_loc_19E4:         # 17F\n \
    movl    %%eax,_gploc_point_c\n \
    movl    _gploc_pt_cu,%%eax\n \
    subl    _gploc_pt_au,%%eax\n \
    shll    $1,%%eax\n \
    imull   %%ebx\n \
    movw    %%dx,%%ax\n \
    roll    $0x10,%%eax\n \
    jns gpo_loc_19FD\n \
    incl    %%eax\n \
\n \
gpo_loc_19FD:         # 180A\n \
    movl    %%eax,_mapxveltop\n \
    movl    _gploc_pt_cv,%%eax\n \
    subl    _gploc_pt_av,%%eax\n \
    shll    $1,%%eax\n \
    imull   %%ebx\n \
    movw    %%dx,%%ax\n \
    roll    $0x10,%%eax\n \
    jns gpo_loc_1A16\n \
    incl    %%eax\n \
\n \
gpo_loc_1A16:         # 1823\n \
    movl    %%eax,_mapyveltop\n \
\n \
gpo_loc_1A1A:         # 17B6\n \
    movl    _gploc_pt_as,%%eax\n \
    shll    $0x10,%%eax\n \
    movl    %%eax,_startposshadetop\n \
    movl    _gploc_pt_au,%%eax\n \
    shll    $0x10,%%eax\n \
    movl    %%eax,_startposmapxtop\n \
    movl    _gploc_pt_av,%%eax\n \
    shll    $0x10,%%eax\n \
    movl    %%eax,_startposmapytop\n \
    movl    _gploc_pt_bs,%%eax\n \
    shll    $0x10,%%eax\n \
    movl    %%eax,_startposshadebottom\n \
    movl    _gploc_pt_bu,%%eax\n \
    shll    $0x10,%%eax\n \
    movl    %%eax,_startposmapxbottom\n \
    movl    _gploc_pt_bv,%%eax\n \
    shll    $0x10,%%eax\n \
    movl    %%eax,_startposmapybottom\n \
    movl    _mapxhstep,%%eax\n \
    movl    %%eax,%%edx\n \
    shll    $0x10,%%eax\n \
    sarl    $0x10,%%edx\n \
    movw    _gploc_word03,%%ax\n \
    orw %%ax,%%ax\n \
    jns gpo_loc_1A92\n \
    subl    $0x10000,%%eax\n \
    sbbb    $0,%%dl\n \
\n \
gpo_loc_1A92:         # 1898\n \
    movl    %%eax,_gploc_BC\n \
    movl    %%edx,_gploc_B8\n \
    movl    _mapyhstep,%%eax\n \
    shll    $0x10,%%eax\n \
    movl    _mapyhstep,%%edx\n \
    sarl    $0x10,%%edx\n \
    movb    _gploc_B8,%%al\n \
    orb %%al,%%al\n \
    jns gpo_loc_1AC7\n \
    subl    $0x100,%%eax\n \
    sbbb    $0,%%dl\n \
\n \
gpo_loc_1AC7:         # 18CD\n \
    movl    %%eax,_gploc_B8\n \
    movl    %%edx,_gploc_B4\n \
    movl    _mapxhstep,%%eax\n \
    movl    %%eax,%%edx\n \
    shll    $0x10,%%eax\n \
    sarl    $0x10,%%edx\n \
    movw    _gploc_word03,%%ax\n \
    orw %%ax,%%ax\n \
    jns gpo_loc_1AF9\n \
    subl    $0x0FFFF,%%eax\n \
    sbbb    $0,%%dl\n \
\n \
gpo_loc_1AF9:         # 18F\n \
    movl    %%eax,_gploc_5C\n \
    movl    %%edx,_gploc_2C\n \
    movl    _mapyhstep,%%eax\n \
    shll    $0x10,%%eax\n \
    movl    _mapyhstep,%%edx\n \
    sarl    $0x10,%%edx\n \
    movb    _gploc_2C,%%al\n \
    orb %%al,%%al\n \
    jns gpo_loc_1B2E\n \
    subl    $0x100,%%eax\n \
    sbbb    $0,%%dl\n \
\n \
gpo_loc_1B2E:         # 193\n \
    movl    %%eax,_gploc_2C\n \
    movl    %%edx,_gploc_28\n \
    movl    _mapxveltop,%%eax\n \
    movl    %%eax,%%edx\n \
    shll    $0x10,%%eax\n \
    sarl    $0x10,%%edx\n \
    movw    _gploc_word01,%%ax\n \
    orw %%ax,%%ax\n \
    jns gpo_loc_1B5A\n \
    subl    $0x10000,%%eax\n \
    sbbb    $0,%%dl\n \
\n \
gpo_loc_1B5A:         # 1960\n \
    movl    %%eax,_gploc_A4\n \
    movl    %%edx,_gploc_A0\n \
    movl    _mapyveltop,%%eax\n \
    shll    $0x10,%%eax\n \
    movl    _mapyveltop,%%edx\n \
    sarl    $0x10,%%edx\n \
    movb    _gploc_A0,%%al\n \
    orb %%al,%%al\n \
    jns gpo_loc_1B89\n \
    subl    $0x100,%%eax\n \
    sbbb    $0,%%dl\n \
\n \
gpo_loc_1B89:         # 198\n \
    movl    %%eax,_gploc_A0\n \
    movl    %%edx,_gploc_9C\n \
    movl    _startposshadetop,%%ebx\n \
    movl    _startposmapxtop,%%ecx\n \
    movl    _startposmapytop,%%edx\n \
    movb    %%bl,_gploc_84\n \
    shrl    $8,%%ebx\n \
    movl    %%ecx,%%eax\n \
    shll    $0x10,%%ecx\n \
    shrl    $0x10,%%eax\n \
    movw    %%bx,%%cx\n \
    movl    %%ecx,_gploc_8C\n \
    movl    %%edx,%%ecx\n \
    shll    $0x10,%%ecx\n \
    shll    $8,%%edx\n \
    shrl    $0x18,%%edx\n \
    shll    $8,%%edx\n \
    movb    %%al,%%cl\n \
    movl    %%ecx,_gploc_88\n \
    movb    _gploc_84,%%dl\n \
    movl    %%edx,_gploc_84\n \
    movl    _factor_chk,%%esi\n \
    orl %%esi,%%esi\n \
    js  gpo_loc_1CAA\n \
    movl    _gploc_198,%%eax\n \
    movl    %%eax,%%edx\n \
    shll    $0x10,%%eax\n \
    sarl    $0x10,%%edx\n \
    movw    _gploc_word02,%%ax\n \
    orw %%ax,%%ax\n \
    jns gpo_loc_1C17\n \
    subl    $0x10000,%%eax\n \
    sbbb    $0,%%dl\n \
\n \
gpo_loc_1C17:         # 1A1D\n \
    movl    %%eax,_gploc_98\n \
    movl    %%edx,_gploc_94\n \
    movl    _gploc_18C,%%eax\n \
    shll    $0x10,%%eax\n \
    movl    _gploc_18C,%%edx\n \
    sarl    $0x10,%%edx\n \
    movb    _gploc_94,%%al\n \
    orb %%al,%%al\n \
    jns gpo_loc_1C46\n \
    subl    $0x100,%%eax\n \
    sbbb    $0,%%dl\n \
\n \
gpo_loc_1C46:         # 1A4C\n \
    movl    %%eax,_gploc_94\n \
    movl    %%edx,_gploc_90\n \
    movl    _startposshadebottom,%%ebx\n \
    movl    _startposmapxbottom,%%ecx\n \
    movl    _startposmapybottom,%%edx\n \
    movb    %%bl,_gploc_78\n \
    shrl    $8,%%ebx\n \
    movl    %%ecx,%%eax\n \
    shll    $0x10,%%ecx\n \
    shrl    $0x10,%%eax\n \
    movw    %%bx,%%cx\n \
    movl    %%ecx,_gploc_80\n \
    movl    %%edx,%%ecx\n \
    shll    $0x10,%%ecx\n \
    shll    $8,%%edx\n \
    shrl    $0x18,%%edx\n \
    shll    $8,%%edx\n \
    movb    %%al,%%cl\n \
    movl    %%ecx,_gploc_7C\n \
    movb    _gploc_78,%%dl\n \
    movl    %%edx,_gploc_78\n \
\n \
gpo_loc_1CAA:\n \
    popa    \n \
" : : : "memory", "cc");
#endif
}

void draw_gpoly_sub7a()
{
    int v0 = gploc_pt_cy - gploc_pt_ay;
    int v1 = (gploc_pt_bx - gploc_pt_ax) * (gploc_pt_cy - gploc_pt_ay);
    if (factor_chk >= 0)
        v1 -= 2 * v0;

    int v2 = (gploc_pt_cx - gploc_pt_ax) * (gploc_pt_by - gploc_pt_ay) - (v0 + v1);

    if (v2 != 0)
    {
        int v3 = 0x7FFFFFFF / v2;
        int v4 = gploc_pt_cy - gploc_pt_ay;
        int v5 = gploc_pt_by - gploc_pt_ay;

        // First component: shadehstep
        {
            int64_t num = (int64_t)v5 * (gploc_pt_cs - gploc_pt_as) - (int64_t)v4 * (gploc_pt_bs - gploc_pt_as);
            int64_t result = 2 * num * v3;
            shadehstep = (int)((result >> 16) + ((result < 0) ? 1 : 0));
        }

        // Second component: mapxhstep
        {
            int64_t num = (int64_t)v5 * (gploc_pt_cu - gploc_pt_au) - (int64_t)v4 * (gploc_pt_bu - gploc_pt_au);
            int64_t result = 2 * num * v3;
            mapxhstep = (int)((result >> 16) + ((result < 0) ? 1 : 0));
        }

        // Third component: mapyhstep
        {
            int64_t num = (int64_t)v5 * (gploc_pt_cv - gploc_pt_av) - (int64_t)v4 * (gploc_pt_bv - gploc_pt_av);
            int64_t result = 2 * num * v3;
            mapyhstep = (int)((result >> 16) + ((result < 0) ? 1 : 0));
        }
    }
    else
    {
        shadehstep = 0;
        mapxhstep = 0;
        mapyhstep = 0;
    }
}


void draw_gpoly_sub7b_block1(void);
void draw_gpoly_sub7b_block2(void);
void draw_gpoly_sub7b_block3(void);

void draw_gpoly_sub7b()
{

    if (factor_chk < 0)
    {
        draw_gpoly_sub7b_block2();
    }
    else
    {
        draw_gpoly_sub7b_block1();
    }

    draw_gpoly_sub7b_block3();

}


static inline int32_t shift_mul(int32_t delta, int32_t scale)
{
    // 64-bit result of signed multiplication
    int64_t result = (int64_t)delta * scale;

    // Split into low and high 32-bit words
    uint32_t lo = (uint32_t)(result & 0xFFFFFFFF);
    uint32_t hi = (uint32_t)((uint64_t)result >> 32);

    // Overwrite low 16 bits of lo with low 16 bits of hi
    lo = (lo & 0xFFFF0000) | (hi & 0x0000FFFF);

    // Rotate left by 16 bits
    uint32_t rotated = (lo << 16) | (lo >> 16);

    // If result is negative, increment
    if ((int32_t)rotated < 0)
        rotated++;

    return (int32_t)rotated;
}

void draw_gpoly_sub7b_block1(void)
{
    int32_t dy_ab = gploc_pt_by - gploc_pt_ay;
    int32_t scale1 = (dy_ab > 255) ? (0x7FFFFFFF / dy_ab) : gpoly_reptable[dy_ab];

    gploc_point_c = shift_mul(2 * (gploc_pt_bs - gploc_pt_as), scale1);
    mapxveltop    = shift_mul(2 * (gploc_pt_bu - gploc_pt_au), scale1);
    mapyveltop    = shift_mul(2 * (gploc_pt_bv - gploc_pt_av), scale1);

    int32_t dy_bc = gploc_pt_cy - gploc_pt_by;
    int32_t scale2 = (dy_bc > 255) ? (0x7FFFFFFF / dy_bc) : gpoly_reptable[dy_bc];

    gploc_1A0 = shift_mul(2 * (gploc_pt_cs - gploc_pt_bs), scale2);
    gploc_198 = shift_mul(2 * (gploc_pt_cu - gploc_pt_bu), scale2);
    gploc_18C = shift_mul(2 * (gploc_pt_cv - gploc_pt_bv), scale2);
}

static inline int rol16_from_product(int64_t product)
{
    uint32_t eax = (uint32_t)(product & 0xFFFFFFFF);
    uint16_t dx = (uint16_t)(product >> 32);
    eax = (dx << 16) | (eax >> 16); // this mimics: movw dx, ax; rol eax, 16
    if ((int32_t)eax < 0)
        ++eax;
    return eax;
}

void draw_gpoly_sub7b_block2(void)
{
    int dy = gploc_pt_cy - gploc_pt_ay;
    int factor = (dy > 255) ? (0x7FFFFFFF / dy) : gpoly_reptable[dy];

    int delta = gploc_pt_cs - gploc_pt_as;
    int64_t product = (int64_t)factor * (delta * 2);
    gploc_point_c = rol16_from_product(product);

    delta = gploc_pt_cu - gploc_pt_au;
    product = (int64_t)factor * (delta * 2);
    mapxveltop = rol16_from_product(product);

    delta = gploc_pt_cv - gploc_pt_av;
    product = (int64_t)factor * (delta * 2);
    mapyveltop = rol16_from_product(product);
}



void draw_gpoly_sub7b_block3(void)
{
    //----------------------------------------------------------------
    // 1) Write the six startpos values exactly as in the ASM:
    //----------------------------------------------------------------
    startposshadetop    = (uint32_t)( (int32_t)gploc_pt_as   << 16 );
    startposmapxtop     = (uint32_t)( (int32_t)gploc_pt_au   << 16 );
    startposmapytop     = (uint32_t)( (int32_t)gploc_pt_av   << 16 );
    startposshadebottom = (uint32_t)( (int32_t)gploc_pt_bs   << 16 );
    startposmapxbottom  = (uint32_t)( (int32_t)gploc_pt_bu   << 16 );
    startposmapybottom  = (uint32_t)( (int32_t)gploc_pt_bv   << 16 );

    //----------------------------------------------------------------
    // 2) TOPSHADING INTERPOLATION  gploc_30, gploc_BC, gploc_B8
    //----------------------------------------------------------------
    {

        int32_t m_y       = (int32_t)mapyhstep;
        int32_t s         = (int32_t)(shadehstep >> 8);

        // Build the 48-bit fixedpoint value in a 64bit container:
        int64_t val       = ((int64_t)m_y << 16);

        // If (shadehstep>>8) is negative, emulate the andl $0x0FFFF; subl $0x10000; sbbl $0,EDX exactly:
        if (s < 0) {
            // EBX = (uint16_t)s
            uint32_t s16 = (uint32_t)( (uint16_t)s );
            // EAX -= 0x10000    val -= 0x10000
            val -= ((int64_t)0x10000);
            // Add back (uint16_t)s
            val += (int64_t)s16;
        }
        else {
            // s  0    just add s
            val += (int64_t)s;
        }

        // Now split val into low32bits = EAX and high32bits = EDX (signed):
        uint32_t low32 = (uint32_t)val;
        int32_t  high32 = (int32_t)( val >> 32 );  // arithmetic shift

        // gploc_30  (shadehstep << 24):
        gploc_30 = (uint32_t)( (int32_t)shadehstep << 24 );
        // gploc_BC  lowword (EAX):
        gploc_BC = low32;

        // Next: gploc_B8 = ( (mapxhstep + (high32<0 ? -1 : 0)) << 8 ) | (high32 & 0xFF)
        int32_t mx = (int32_t)mapxhstep;
        if (high32 < 0) {
            mx -= 1;
        }
        gploc_B8 = ( (uint32_t)mx << 8 ) | ( (uint32_t)high32 & 0xFF );
    }

    //----------------------------------------------------------------
    // 3) BOTTOMSHADING INTERPOLATION  gploc_5C, gploc_2C
    //----------------------------------------------------------------
    {

        int32_t m_y   = (int32_t)mapyhstep;
        int32_t s     = (int32_t)(shadehstep >> 8);

        int64_t val   = ((int64_t)m_y << 16);

        if (s < 0) {
            // EBX = (uint16_t)s
            uint32_t s16 = (uint32_t)((uint16_t)s);
            // EAX -= 0x0FFFF
            val -= ((int64_t)0x0FFFF);
            // add EBX
            val += (int64_t)s16;
        }
        else {
            val += (int64_t)s;
        }

        uint32_t low32  = (uint32_t)val;
        int32_t  high32 = (int32_t)(val >> 32);

        // Store EAXgploc_5C
        gploc_5C = low32;

        // gploc_2C = ( (mapxhstep + (high32<0 ? -1 : 0)) << 8 ) | (high32 & 0xFF)
        int32_t mx      = (int32_t)mapxhstep;
        if (high32 < 0) {
            mx -= 1;
        }
        gploc_2C = ( (uint32_t)mx << 8 ) | ( (uint32_t)high32 & 0xFF );
    }

    //----------------------------------------------------------------
    // 4) TOP POINTC INTERPOLATION  gploc_68, gploc_A4, gploc_A0
    //----------------------------------------------------------------
    {
        int32_t m_y   = (int32_t)mapyveltop;
        int64_t val   = ((int64_t)m_y << 16);

        // Build gploc_68 = (gploc_point_c << 24)
        int32_t ptc     = (int32_t)gploc_point_c;
        gploc_68        = (uint32_t)(ptc << 24);

        int32_t s       = (int32_t)(ptc >> 8);
        if (s < 0) {
            uint32_t s16 = (uint32_t)((uint16_t)s);
            val -= ((int64_t)0x10000);
            val += (int64_t)s16;
        }
        else {
            val += (int64_t)s;
        }

        uint32_t low32  = (uint32_t)val;
        int32_t  high32 = (int32_t)(val >> 32);
        gploc_A4        = low32;

        // gploc_A0 = ( (mapxveltop + (high32<0 ? -1 : 0)) << 8 ) | (high32 & 0xFF)
        int32_t mx      = (int32_t)mapxveltop;
        if (high32 < 0) {
            mx -= 1;
        }
        gploc_A0 = ( (uint32_t)mx << 8 ) | ( (uint32_t)high32 & 0xFF );
    }

    //----------------------------------------------------------------
    // 5) COMBINE STARTPOS FOR TOP:  gploc_8C, gploc_88
    //----------------------------------------------------------------
    {
        uint32_t sp_y = startposmapytop;
        uint32_t sp_s = startposshadetop;
        uint32_t sp_x = startposmapxtop;

        // gploc_8C = (sp_s >> 8) | (sp_y << 16)
        gploc_8C = ( (uint32_t)sp_s >> 8 ) | ( (uint32_t)sp_y << 16 );

        // gploc_88 = (sp_x << 8) | ((sp_y >> 16) & 0xFF)
        gploc_88 = ( (uint32_t)sp_x << 8 ) | ( ((uint32_t)sp_y >> 16) & 0xFF );
    }

    //----------------------------------------------------------------
    // 6) IF (factor_chk >= 0) THEN  BOTTOM POINTC BLOCK
    //----------------------------------------------------------------
    if ( (int32_t)factor_chk >= 0 )
    {
        int32_t m_y   = (int32_t)gploc_18C;
        int64_t val   = ((int64_t)m_y << 16);

        // gploc_64 = (gploc_1A0 << 24)
        int32_t s0    = (int32_t)gploc_1A0;
        gploc_64      = (uint32_t)(s0 << 24);

        int32_t s1    = (int32_t)(s0 >> 8);
        if (s1 < 0) {
            uint32_t s16 = (uint32_t)((uint16_t)s1);
            val -= ((int64_t)0x10000);
            val += (int64_t)s16;
        }
        else {
            val += (int64_t)s1;
        }

        uint32_t low32  = (uint32_t)val;
        int32_t  high32 = (int32_t)(val >> 32);
        gploc_98        = low32;

        // gploc_94 = ( (gploc_198 + (high32<0 ? -1 : 0)) << 8 ) | (high32 & 0xFF)
        int32_t mx      = (int32_t)gploc_198;
        if (high32 < 0) {
            mx -= 1;
        }
        gploc_94 = ( (uint32_t)mx << 8 ) | ( (uint32_t)high32 & 0xFF );

        //----------------------------------------------------------------
        // Finally, combine bottom startpos  gploc_80, gploc_7C
        //----------------------------------------------------------------
        {
            uint32_t sp_yb = startposmapybottom;
            uint32_t sp_sb = startposshadebottom;
            uint32_t sp_xb = startposmapxbottom;

            // gploc_80 = (sp_sb >> 8) | (sp_yb << 16)
            gploc_80 = ( (uint32_t)sp_sb >> 8 ) | ( (uint32_t)sp_yb << 16 );

            // gploc_7C = (sp_xb << 8) | ((sp_yb >> 16) & 0xFF)
            gploc_7C = ( (uint32_t)sp_xb << 8 ) | ( ((uint32_t)sp_yb >> 16) & 0xFF );
        }
    }
}

void draw_gpoly_sub13()
{
#if __GNUC__
    asm volatile (" \
    pusha   \n \
    xorl    %%ecx,%%ecx\n \
    movl    _gploc_8C,%%edx\n \
    movl    _gploc_88,%%ebx\n \
    movl    _gploc_pt_ay,%%esi\n \
    movl    _LOC_vec_screen_width,%%edi\n \
    imull   %%esi,%%edi\n \
    addl    _LOC_vec_screen,%%edi\n \
    movl    _gploc_pt_ay,%%eax\n \
    cmpl    _LOC_vec_window_height,%%eax\n \
    jg  locret69a\n \
    movl    _gploc_pt_by,%%eax\n \
    cmpl    _LOC_vec_window_height,%%eax\n \
    jle loc_783508\n \
    movl    _LOC_vec_window_height,%%eax\n \
\n \
loc_783508:         # 331\n \
    subl    _gploc_pt_ay,%%eax\n \
    movl    %%eax,_gploc_C0\n \
    movl    _gploc_pt_ax,%%esi\n \
    movl    %%esi,_gploc_74\n \
    movl    _gploc_pt_shax,%%eax\n \
    movl    %%eax,%%ebp\n \
    jz  loc_783A68\n \
    movl    _gploc_pt_ay,%%esi\n \
    orl %%esi,%%esi\n \
    js  loc_7839E0\n \
    movl    _gploc_74,%%esi\n \
    jmp loc_783899\n \
# ---------------------------------------------------------------------------\n \
\n \
loc_783542:         # 361C\n \
    xorl    %%eax,%%eax\n \
    movb    (%%ecx,%%esi),%%al\n \
    movl    $0x0FF00,%%ecx\n \
    andl    %%edx,%%ecx\n \
    orl %%eax,%%ecx\n \
    xorl    %%eax,%%eax\n \
    pushl   %%ebx\n \
    movl    _render_fade_tables,%%ebx\n \
    movb    (%%ebx,%%ecx),%%al\n \
    popl    %%ebx\n \
    movl    $0x0FF0000FF,%%ecx\n \
    movb    %%al,(%%edi)\n \
    andl    %%ebx,%%ecx\n \
    addl    %%ebp,%%edx\n \
    adcl    _gploc_2C,%%ebx\n \
    roll    $8,%%ecx\n \
\n \
loc_78356D:         # 3EEC\n \
    xorl    %%eax,%%eax\n \
    movb    (%%ecx,%%esi),%%al\n \
    movl    $0x0FF00,%%ecx\n \
    andl    %%edx,%%ecx\n \
    orl %%eax,%%ecx\n \
    xorl    %%eax,%%eax\n \
    pushl   %%ebx\n \
    movl    _render_fade_tables,%%ebx\n \
    movb    (%%ebx,%%ecx),%%al\n \
    popl    %%ebx\n \
    movl    $0x0FF0000FF,%%ecx\n \
    movb    %%al,1(%%edi)\n \
    andl    %%ebx,%%ecx\n \
    addl    %%ebp,%%edx\n \
    adcl    _gploc_2C,%%ebx\n \
    roll    $8,%%ecx\n \
\n \
loc_783599:         # 3EE8\n \
    xorl    %%eax,%%eax\n \
    movb    (%%ecx,%%esi),%%al\n \
    movl    $0x0FF00,%%ecx\n \
    andl    %%edx,%%ecx\n \
    orl %%eax,%%ecx\n \
    xorl    %%eax,%%eax\n \
    pushl   %%ebx\n \
    movl    _render_fade_tables,%%ebx\n \
    movb    (%%ebx,%%ecx),%%al\n \
    popl    %%ebx\n \
    movl    $0x0FF0000FF,%%ecx\n \
    movb    %%al,2(%%edi)\n \
    andl    %%ebx,%%ecx\n \
    addl    %%ebp,%%edx\n \
    adcl    _gploc_2C,%%ebx\n \
    roll    $8,%%ecx\n \
\n \
loc_7835C5:         # 3EE4\n \
    xorl    %%eax,%%eax\n \
    movb    (%%ecx,%%esi),%%al\n \
    movl    $0x0FF00,%%ecx\n \
    andl    %%edx,%%ecx\n \
    orl %%eax,%%ecx\n \
    xorl    %%eax,%%eax\n \
    pushl   %%ebx\n \
    movl    _render_fade_tables,%%ebx\n \
    movb    (%%ebx,%%ecx),%%al\n \
    popl    %%ebx\n \
    movl    $0x0FF0000FF,%%ecx\n \
    movb    %%al,3(%%edi)\n \
    andl    %%ebx,%%ecx\n \
    addl    %%ebp,%%edx\n \
    adcl    _gploc_2C,%%ebx\n \
    roll    $8,%%ecx\n \
\n \
loc_7835F1:         # 3EE0\n \
    xorl    %%eax,%%eax\n \
    movb    (%%ecx,%%esi),%%al\n \
    movl    $0x0FF00,%%ecx\n \
    andl    %%edx,%%ecx\n \
    orl %%eax,%%ecx\n \
    xorl    %%eax,%%eax\n \
    pushl   %%ebx\n \
    movl    _render_fade_tables,%%ebx\n \
    movb    (%%ebx,%%ecx),%%al\n \
    popl    %%ebx\n \
    movl    $0x0FF0000FF,%%ecx\n \
    movb    %%al,4(%%edi)\n \
    andl    %%ebx,%%ecx\n \
    addl    %%ebp,%%edx\n \
    adcl    _gploc_2C,%%ebx\n \
    roll    $8,%%ecx\n \
\n \
loc_78361D:         # 3EDC\n \
    xorl    %%eax,%%eax\n \
    movb    (%%ecx,%%esi),%%al\n \
    movl    $0x0FF00,%%ecx\n \
    andl    %%edx,%%ecx\n \
    orl %%eax,%%ecx\n \
    xorl    %%eax,%%eax\n \
    pushl   %%ebx\n \
    movl    _render_fade_tables,%%ebx\n \
    movb    (%%ebx,%%ecx),%%al\n \
    popl    %%ebx\n \
    movl    $0x0FF0000FF,%%ecx\n \
    movb    %%al,5(%%edi)\n \
    andl    %%ebx,%%ecx\n \
    addl    %%ebp,%%edx\n \
    adcl    _gploc_2C,%%ebx\n \
    roll    $8,%%ecx\n \
\n \
loc_783649:         # 3ED8\n \
    xorl    %%eax,%%eax\n \
    movb    (%%ecx,%%esi),%%al\n \
    movl    $0x0FF00,%%ecx\n \
    andl    %%edx,%%ecx\n \
    orl %%eax,%%ecx\n \
    xorl    %%eax,%%eax\n \
    pushl   %%ebx\n \
    movl    _render_fade_tables,%%ebx\n \
    movb    (%%ebx,%%ecx),%%al\n \
    popl    %%ebx\n \
    movl    $0x0FF0000FF,%%ecx\n \
    movb    %%al,6(%%edi)\n \
    andl    %%ebx,%%ecx\n \
    addl    %%ebp,%%edx\n \
    adcl    _gploc_2C,%%ebx\n \
    roll    $8,%%ecx\n \
\n \
loc_783675:         # 3ED4\n \
    xorl    %%eax,%%eax\n \
    movb    (%%ecx,%%esi),%%al\n \
    movl    $0x0FF00,%%ecx\n \
    andl    %%edx,%%ecx\n \
    orl %%eax,%%ecx\n \
    xorl    %%eax,%%eax\n \
    pushl   %%ebx\n \
    movl    _render_fade_tables,%%ebx\n \
    movb    (%%ebx,%%ecx),%%al\n \
    popl    %%ebx\n \
    movl    $0x0FF0000FF,%%ecx\n \
    movb    %%al,7(%%edi)\n \
    andl    %%ebx,%%ecx\n \
    addl    %%ebp,%%edx\n \
    adcl    _gploc_2C,%%ebx\n \
    roll    $8,%%ecx\n \
\n \
loc_7836A1:         # 3ED0\n \
    xorl    %%eax,%%eax\n \
    movb    (%%ecx,%%esi),%%al\n \
    movl    $0x0FF00,%%ecx\n \
    andl    %%edx,%%ecx\n \
    orl %%eax,%%ecx\n \
    xorl    %%eax,%%eax\n \
    pushl   %%ebx\n \
    movl    _render_fade_tables,%%ebx\n \
    movb    (%%ebx,%%ecx),%%al\n \
    popl    %%ebx\n \
    movl    $0x0FF0000FF,%%ecx\n \
    movb    %%al,8(%%edi)\n \
    andl    %%ebx,%%ecx\n \
    addl    %%ebp,%%edx\n \
    adcl    _gploc_2C,%%ebx\n \
    roll    $8,%%ecx\n \
\n \
loc_7836CD:         # 3ECC\n \
    xorl    %%eax,%%eax\n \
    movb    (%%ecx,%%esi),%%al\n \
    movl    $0x0FF00,%%ecx\n \
    andl    %%edx,%%ecx\n \
    orl %%eax,%%ecx\n \
    xorl    %%eax,%%eax\n \
    pushl   %%ebx\n \
    movl    _render_fade_tables,%%ebx\n \
    movb    (%%ebx,%%ecx),%%al\n \
    popl    %%ebx\n \
    movl    $0x0FF0000FF,%%ecx\n \
    movb    %%al,9(%%edi)\n \
    andl    %%ebx,%%ecx\n \
    addl    %%ebp,%%edx\n \
    adcl    _gploc_2C,%%ebx\n \
    roll    $8,%%ecx\n \
\n \
loc_7836F9:         # 3EC8\n \
    xorl    %%eax,%%eax\n \
    movb    (%%ecx,%%esi),%%al\n \
    movl    $0x0FF00,%%ecx\n \
    andl    %%edx,%%ecx\n \
    orl %%eax,%%ecx\n \
    xorl    %%eax,%%eax\n \
    pushl   %%ebx\n \
    movl    _render_fade_tables,%%ebx\n \
    movb    (%%ebx,%%ecx),%%al\n \
    popl    %%ebx\n \
    movl    $0x0FF0000FF,%%ecx\n \
    movb    %%al,0x0A(%%edi)\n \
    andl    %%ebx,%%ecx\n \
    addl    %%ebp,%%edx\n \
    adcl    _gploc_2C,%%ebx\n \
    roll    $8,%%ecx\n \
\n \
loc_783725:         # 3EC4\n \
    xorl    %%eax,%%eax\n \
    movb    (%%ecx,%%esi),%%al\n \
    movl    $0x0FF00,%%ecx\n \
    andl    %%edx,%%ecx\n \
    orl %%eax,%%ecx\n \
    xorl    %%eax,%%eax\n \
    pushl   %%ebx\n \
    movl    _render_fade_tables,%%ebx\n \
    movb    (%%ebx,%%ecx),%%al\n \
    popl    %%ebx\n \
    movl    $0x0FF0000FF,%%ecx\n \
    movb    %%al,0x0B(%%edi)\n \
    andl    %%ebx,%%ecx\n \
    addl    %%ebp,%%edx\n \
    adcl    _gploc_2C,%%ebx\n \
    roll    $8,%%ecx\n \
\n \
loc_783751:         # 3EC0\n \
    xorl    %%eax,%%eax\n \
    movb    (%%ecx,%%esi),%%al\n \
    movl    $0x0FF00,%%ecx\n \
    andl    %%edx,%%ecx\n \
    orl %%eax,%%ecx\n \
    xorl    %%eax,%%eax\n \
    pushl   %%ebx\n \
    movl    _render_fade_tables,%%ebx\n \
    movb    (%%ebx,%%ecx),%%al\n \
    popl    %%ebx\n \
    movl    $0x0FF0000FF,%%ecx\n \
    movb    %%al,0x0C(%%edi)\n \
    andl    %%ebx,%%ecx\n \
    addl    %%ebp,%%edx\n \
    adcl    _gploc_2C,%%ebx\n \
    roll    $8,%%ecx\n \
\n \
loc_78377D:         # 3EBC\n \
    xorl    %%eax,%%eax\n \
    movb    (%%ecx,%%esi),%%al\n \
    movl    $0x0FF00,%%ecx\n \
    andl    %%edx,%%ecx\n \
    orl %%eax,%%ecx\n \
    xorl    %%eax,%%eax\n \
    pushl   %%ebx\n \
    movl    _render_fade_tables,%%ebx\n \
    movb    (%%ebx,%%ecx),%%al\n \
    popl    %%ebx\n \
    movl    $0x0FF0000FF,%%ecx\n \
    movb    %%al,0x0D(%%edi)\n \
    andl    %%ebx,%%ecx\n \
    addl    %%ebp,%%edx\n \
    adcl    _gploc_2C,%%ebx\n \
    roll    $8,%%ecx\n \
\n \
loc_7837A9:         # 3EB8\n \
    xorl    %%eax,%%eax\n \
    movb    (%%ecx,%%esi),%%al\n \
    movl    $0x0FF00,%%ecx\n \
    andl    %%edx,%%ecx\n \
    orl %%eax,%%ecx\n \
    xorl    %%eax,%%eax\n \
    pushl   %%ebx\n \
    movl    _render_fade_tables,%%ebx\n \
    movb    (%%ebx,%%ecx),%%al\n \
    popl    %%ebx\n \
    movl    $0x0FF0000FF,%%ecx\n \
    movb    %%al,0x0E(%%edi)\n \
    andl    %%ebx,%%ecx\n \
    addl    %%ebp,%%edx\n \
    adcl    _gploc_2C,%%ebx\n \
    roll    $8,%%ecx\n \
\n \
loc_7837D5:         # 3EB4\n \
    xorl    %%eax,%%eax\n \
    movb    (%%ecx,%%esi),%%al\n \
    movl    $0x0FF00,%%ecx\n \
    andl    %%edx,%%ecx\n \
    orl %%eax,%%ecx\n \
    xorl    %%eax,%%eax\n \
    pushl   %%ebx\n \
    movl    _render_fade_tables,%%ebx\n \
    movb    (%%ebx,%%ecx),%%al\n \
    popl    %%ebx\n \
    movl    $0x0FF0000FF,%%ecx\n \
    movb    %%al,0x0F(%%edi)\n \
    andl    %%ebx,%%ecx\n \
    addl    %%ebp,%%edx\n \
    adcl    _gploc_2C,%%ebx\n \
    roll    $8,%%ecx\n \
    addl    $0x10,%%edi\n \
    subl    $0x10,_gploc_D4\n \
    jg  loc_783542\n \
\n \
loc_783812:         # 370B\n \
    movl    _g_shadeAccumulator,%%eax\n \
    movl    _g_shadeAccumulatorNext,%%ebp\n \
    movl    _gploc_F4,%%edi\n \
    movl    _gploc_74,%%esi\n \
    sarl    $0x10,%%eax\n \
    subl    %%eax,%%esi\n \
    movl    _g_shadeAccumulator,%%eax\n \
    addl    _gploc_12C,%%eax\n \
    addl    _gploc_128,%%ebp\n \
    movl    %%eax,_g_shadeAccumulator\n \
    sarl    $0x10,%%eax\n \
    addl    %%eax,%%esi\n \
    movl    _g_shadeAccumulator,%%eax\n \
    movl    _gploc_34,%%ecx\n \
    movl    _gploc_D8,%%edx\n \
    movl    _gploc_E4,%%ebx\n \
    addl    _gploc_60,%%ecx\n \
    adcl    _gploc_CC,%%edx\n \
    adcl    _gploc_C4,%%ebx\n \
    addl    _gploc_104,%%edi\n \
    decl _gploc_C0\n \
    jz  loc_783A68\n \
\n \
loc_783899:         # 334D\n \
    movl    %%eax,_g_shadeAccumulator\n \
    movl    %%ebp,_g_shadeAccumulatorNext\n \
    movl    %%edi,_gploc_F4\n \
    sarl    $0x10,%%eax\n \
    js  loc_783980\n \
    cmpl    %%esi,%%eax\n \
    jg  loc_783940\n \
    jl  loc_783960\n \
\n \
loc_7838C5:         # 3768\n \
    movl    %%esi,_gploc_74\n \
    movl    _gploc_F4,%%edi\n \
    movl    %%ecx,_gploc_34\n \
    movl    %%edx,_gploc_D8\n \
    movl    %%ebx,_gploc_E4\n \
    sarl    $0x10,%%ebp\n \
    cmpl    _LOC_vec_window_width,%%ebp\n \
    jg  loc_7839D0\n \
\n \
loc_7838F7:         # 37E6\n \
    addl    %%esi,%%edi\n \
    subl    %%esi,%%ebp\n \
    jle loc_783812\n \
    movl    %%ebp,%%eax\n \
    andl    $0x0F,%%eax\n \
    addl    _gpoly_countdown(,%%eax,4),%%edi\n \
    movl    %%ebp,_gploc_D4\n \
    movl    $0x0FF0000FF,%%ecx\n \
    andl    %%ebx,%%ecx\n \
    roll    $8,%%ecx\n \
    movl    _LOC_vec_map,%%esi\n \
    movl    _gploc_5C,%%ebp\n \
    jmp     *off_7840A0(,%%eax,4)\n \
# ---------------------------------------------------------------------------\n \
\n \
loc_783940:         # 36C\n \
    addl    _gploc_30,%%ecx\n \
    adcl    _gploc_BC,%%edx\n \
    adcl    _gploc_B8,%%ebx\n \
    incl    %%esi\n \
    cmpl    %%esi,%%eax\n \
    jle loc_7838C5\n \
    jmp loc_783940\n \
# ---------------------------------------------------------------------------\n \
\n \
loc_783960:         # 36C\n \
    subl    _gploc_30,%%ecx\n \
    sbbl    _gploc_BC,%%edx\n \
    sbbl    _gploc_B8,%%ebx\n \
    decl    %%esi\n \
    cmpl    %%esi,%%eax\n \
    jge loc_7838C5\n \
    jmp loc_783960\n \
# ---------------------------------------------------------------------------\n \
\n \
loc_783980:         # 36C\n \
    orl %%esi,%%esi\n \
    jz  loc_7838C5\n \
    js  loc_783990\n \
    jmp loc_7839B0\n \
# ---------------------------------------------------------------------------\n \
\n \
loc_783990:         # 3798\n \
    addl    _gploc_30,%%ecx\n \
    adcl    _gploc_BC,%%edx\n \
    adcl    _gploc_B8,%%ebx\n \
    incl    %%esi\n \
    jz  loc_7838C5\n \
    jmp loc_783990\n \
# ---------------------------------------------------------------------------\n \
\n \
loc_7839B0:         # 379A\n \
    subl    _gploc_30,%%ecx\n \
    sbbl    _gploc_BC,%%edx\n \
    sbbl    _gploc_B8,%%ebx\n \
    decl    %%esi\n \
    jz  loc_7838C5\n \
    jmp loc_7839B0\n \
# ---------------------------------------------------------------------------\n \
\n \
loc_7839D0:         # 370\n \
    movl    _LOC_vec_window_width,%%ebp\n \
    jmp loc_7838F7\n \
# ---------------------------------------------------------------------------\n \
\n \
loc_7839E0:         # 3340\n \
    addl    _gploc_60,%%ecx\n \
    adcl    _gploc_CC,%%edx\n \
    adcl    _gploc_C4,%%ebx\n \
    movl    %%eax,_g_shadeAccumulator\n \
    sarl    $0x10,%%eax\n \
    subl    %%eax,_gploc_74\n \
    movl    _g_shadeAccumulator,%%eax\n \
    addl    _gploc_12C,%%eax\n \
    addl    _gploc_128,%%ebp\n \
    movl    %%eax,_g_shadeAccumulator\n \
    sarl    $0x10,%%eax\n \
    addl    %%eax,_gploc_74\n \
    movl    _g_shadeAccumulator,%%eax\n \
    addl    _gploc_104,%%edi\n \
    decl _gploc_C0\n \
    jz  loc_783A60\n \
    incl    %%esi\n \
    js  loc_7839E0\n \
    movl    _gploc_74,%%esi\n \
    jmp loc_783899\n \
# ---------------------------------------------------------------------------\n \
\
\n \
loc_783A60:         # 385\n \
    movl    _gploc_74,%%esi\n \
    nop \n \
\n \
loc_783A68:         # 333\n \
    decl _gploc_180\n \
    jz  locret69a\n \
    movl    %%eax,_g_shadeAccumulator\n \
    movl    _factor_chk,%%eax\n \
    orl %%eax,%%eax\n \
    js  loc_783B10\n \
    movl    _factor_cb,%%eax\n \
    movl    %%eax,_gploc_12C\n \
    movl    _gploc_64,%%eax\n \
    movl    %%eax,_gploc_60\n \
    movl    _gploc_98,%%eax\n \
    movl    %%eax,_gploc_CC\n \
    movl    _gploc_94,%%eax\n \
    movl    %%eax,_gploc_C4\n \
    xorl    %%ecx,%%ecx\n \
    movl    _gploc_80,%%edx\n \
    movl    _gploc_7C,%%ebx\n \
    movl    _gploc_pt_cy,%%eax\n \
    cmpl    _LOC_vec_window_height,%%eax\n \
    jle loc_783ADB\n \
    movl    _LOC_vec_window_height,%%eax\n \
\n \
loc_783ADB:         # 38E\n \
    subl    _gploc_pt_by,%%eax\n \
    movl    %%eax,_gploc_C0\n \
    movl    _gploc_pt_bx,%%eax\n \
    movl    %%eax,_gploc_74\n \
    movl    _gploc_pt_shbx,%%eax\n \
    jle locret69a\n \
    movl    _gploc_pt_by,%%esi\n \
    orl %%esi,%%esi\n \
    js  loc_7839E0\n \
    movl    _gploc_pt_bx,%%esi\n \
    jmp loc_783899\n \
# ---------------------------------------------------------------------------\n \
\n \
loc_783B10:         # 388\n \
    movl    _factor_cb,%%ebp\n \
    movl    %%ebp,_gploc_128\n \
    movl    _gploc_pt_shbx,%%ebp\n \
    movl    _gploc_pt_cy,%%eax\n \
    cmpl    _LOC_vec_window_height,%%eax\n \
    jle loc_783B30\n \
    movl    _LOC_vec_window_height,%%eax\n \
\n \
loc_783B30:         # 393\n \
    subl    _gploc_pt_by,%%eax\n \
    movl    %%eax,_gploc_C0\n \
    movl    _g_shadeAccumulator,%%eax\n \
    jle locret69a\n \
    movl    %%esi,_gploc_74\n \
    movl    _gploc_pt_by,%%esi\n \
    orl %%esi,%%esi\n \
    js  loc_7839E0\n \
    movl    _gploc_74,%%esi\n \
    jmp loc_783899\n \
\n \
off_7840A0:\n \
    .int    loc_783542\n \
    .int    loc_7837D5\n \
    .int    loc_7837A9\n \
    .int    loc_78377D\n \
    .int    loc_783751\n \
    .int    loc_783725\n \
    .int    loc_7836F9\n \
    .int    loc_7836CD\n \
    .int    loc_7836A1\n \
    .int    loc_783675\n \
    .int    loc_783649\n \
    .int    loc_78361D\n \
    .int    loc_7835F1\n \
    .int    loc_7835C5\n \
    .int    loc_783599\n \
    .int    loc_78356D\n \
\n \
locret69a:\n \
    popa    \n \
" : : : "memory", "cc");
#endif
}

void draw_gpoly_sub14()
{
  int tex_x_accum_low;
  int tex_x_accum_high;
  int tex_x_accum_combined; // ebx
  uchar *screen_line_ptr; // edi
  int clamped_by; // eax
  bool skip_render; // zf
  int spanCount; // eax
  int xStart; // esi
  int shadeAccumulator; // eax
  int shadeAccumulatorNext; // ebp
  int scanline_y; // esi
  unsigned int v11;
  int fade_lookup_index;
  unsigned int v13;
  unsigned int v14;
  unsigned int v15;
  unsigned int v16;
  unsigned int v17;
  unsigned int v18;
  unsigned int v19;
  unsigned int v20;
  unsigned int v21;
  unsigned int v22;
  unsigned int v23;
  unsigned int v24;
  unsigned int v25;
  unsigned int v26;
  unsigned int v27;
  unsigned __int8 *pixel_dst; // edi
  bool span_too_small_or_complete; // cc
  int x_start_int; // eax
  int x_end_int; // ebp
  unsigned __int8 *screen_line_offset; // edi
  int pixel_span_len; // ebp
  int span_mod16; // eax
  unsigned __int8 *texture_map; // esi
  int texture_step_y; // ebp
  bool carryLow32; // cf
  int clamped_cy; // eax
  int clamped_cy2; // eax
  tex_x_accum_low = 0;
  tex_x_accum_high = gploc_8C;
  tex_x_accum_combined = gploc_88;
  screen_line_ptr = &LOC_vec_screen[gploc_pt_ay * LOC_vec_screen_width];
  if ( gploc_pt_ay <= LOC_vec_window_height )
  {
    clamped_by = gploc_pt_by;
    if ( gploc_pt_by > LOC_vec_window_height )
      clamped_by = LOC_vec_window_height;
    spanCount = clamped_by - gploc_pt_ay;
    skip_render = spanCount == 0;
    gploc_C0 = spanCount;
    xStart = gploc_pt_ax;
    gploc_74 = gploc_pt_ax;
    shadeAccumulator = gploc_pt_shax;
    shadeAccumulatorNext = gploc_pt_shax;
    if ( !skip_render )
    {
      scanline_y = gploc_pt_ay;
      if ( gploc_pt_ay < 0 )
      {
        goto SKEWED_SCAN_ADJUST;
        
      }
      do
      {
REMAINDER_SCANLINE_STEP:
        g_shadeAccumulator = shadeAccumulator;
        g_shadeAccumulatorNext = shadeAccumulatorNext;
        gploc_F4 = screen_line_ptr;
        x_start_int = shadeAccumulator >> 16;
        gploc_34 = tex_x_accum_low;
        gploc_D8 = tex_x_accum_high;
        gploc_E4 = tex_x_accum_combined;
        x_end_int = shadeAccumulatorNext >> 16;
        screen_line_offset = &screen_line_ptr[x_start_int];
        span_too_small_or_complete = x_end_int <= x_start_int;
        pixel_span_len = x_end_int - x_start_int;
        if ( !span_too_small_or_complete )
        {
          span_mod16 = pixel_span_len & 0xF;
          pixel_dst = &screen_line_offset[gpoly_countdown[span_mod16]];
          gploc_D4 = pixel_span_len;
          fade_lookup_index = __ROL4__(tex_x_accum_combined & 0xFF0000FF, 8);
          texture_map = LOC_vec_map;
          texture_step_y = gploc_5C;
          switch ( span_mod16 )
          {
            case 0:
              goto UNROLLED_LOOP_PIXEL0;
            case 1:
              goto UNROLLED_LOOP_PIXEL1;
            case 2:
              goto UNROLLED_LOOP_PIXEL2;
            case 3:
              goto UNROLLED_LOOP_PIXEL3;
            case 4:
              goto UNROLLED_LOOP_PIXEL4;
            case 5:
              goto UNROLLED_LOOP_PIXEL5;
            case 6:
              goto UNROLLED_LOOP_PIXEL6;
            case 7:
              goto UNROLLED_LOOP_PIXEL7;
            case 8:
              goto UNROLLED_LOOP_PIXEL8;
            case 9:
              goto UNROLLED_LOOP_PIXEL9;
            case 10:
              goto UNROLLED_LOOP_PIXEL10;
            case 11:
              goto UNROLLED_LOOP_PIXEL11;
            case 12:
              goto UNROLLED_LOOP_PIXEL12;
            case 13:
              goto UNROLLED_LOOP_PIXEL13;
            case 14:
              goto UNROLLED_LOOP_PIXEL14;
            case 15:
              while ( 1 )
              {
                pixel_dst[1] = render_fade_tables[texture_map[fade_lookup_index] | (tex_x_accum_high & 0xFF00)];
                v13 = tex_x_accum_combined & 0xFF0000FF;
                tex_x_accum_combined = (PAIR64(gploc_2C, texture_step_y) + PAIR64(tex_x_accum_combined, tex_x_accum_high)) >> 32;
                tex_x_accum_high += texture_step_y;
                fade_lookup_index = __ROL4__(v13, 8);
UNROLLED_LOOP_PIXEL14:
                pixel_dst[2] = render_fade_tables[texture_map[fade_lookup_index] | (tex_x_accum_high & 0xFF00)];
                v14 = tex_x_accum_combined & 0xFF0000FF;
                tex_x_accum_combined = (PAIR64(gploc_2C, texture_step_y) + PAIR64(tex_x_accum_combined, tex_x_accum_high)) >> 32;
                tex_x_accum_high += texture_step_y;
                fade_lookup_index = __ROL4__(v14, 8);
UNROLLED_LOOP_PIXEL13:
                pixel_dst[3] = render_fade_tables[texture_map[fade_lookup_index] | (tex_x_accum_high & 0xFF00)];
                v15 = tex_x_accum_combined & 0xFF0000FF;
                tex_x_accum_combined = (PAIR64(gploc_2C, texture_step_y) + PAIR64(tex_x_accum_combined, tex_x_accum_high)) >> 32;
                tex_x_accum_high += texture_step_y;
                fade_lookup_index = __ROL4__(v15, 8);
UNROLLED_LOOP_PIXEL12:
                pixel_dst[4] = render_fade_tables[texture_map[fade_lookup_index] | (tex_x_accum_high & 0xFF00)];
                v16 = tex_x_accum_combined & 0xFF0000FF;
                tex_x_accum_combined = (PAIR64(gploc_2C, texture_step_y) + PAIR64(tex_x_accum_combined, tex_x_accum_high)) >> 32;
                tex_x_accum_high += texture_step_y;
                fade_lookup_index = __ROL4__(v16, 8);
UNROLLED_LOOP_PIXEL11:
                pixel_dst[5] = render_fade_tables[texture_map[fade_lookup_index] | (tex_x_accum_high & 0xFF00)];
                v17 = tex_x_accum_combined & 0xFF0000FF;
                tex_x_accum_combined = (PAIR64(gploc_2C, texture_step_y) + PAIR64(tex_x_accum_combined, tex_x_accum_high)) >> 32;
                tex_x_accum_high += texture_step_y;
                fade_lookup_index = __ROL4__(v17, 8);
UNROLLED_LOOP_PIXEL10:
                pixel_dst[6] = render_fade_tables[texture_map[fade_lookup_index] | (tex_x_accum_high & 0xFF00)];
                v18 = tex_x_accum_combined & 0xFF0000FF;
                tex_x_accum_combined = (PAIR64(gploc_2C, texture_step_y) + PAIR64(tex_x_accum_combined, tex_x_accum_high)) >> 32;
                tex_x_accum_high += texture_step_y;
                fade_lookup_index = __ROL4__(v18, 8);
UNROLLED_LOOP_PIXEL9:
                pixel_dst[7] = render_fade_tables[texture_map[fade_lookup_index] | (tex_x_accum_high & 0xFF00)];
                v19 = tex_x_accum_combined & 0xFF0000FF;
                tex_x_accum_combined = (PAIR64(gploc_2C, texture_step_y) + PAIR64(tex_x_accum_combined, tex_x_accum_high)) >> 32;
                tex_x_accum_high += texture_step_y;
                fade_lookup_index = __ROL4__(v19, 8);
UNROLLED_LOOP_PIXEL8:
                pixel_dst[8] = render_fade_tables[texture_map[fade_lookup_index] | (tex_x_accum_high & 0xFF00)];
                v20 = tex_x_accum_combined & 0xFF0000FF;
                tex_x_accum_combined = (PAIR64(gploc_2C, texture_step_y) + PAIR64(tex_x_accum_combined, tex_x_accum_high)) >> 32;
                tex_x_accum_high += texture_step_y;
                fade_lookup_index = __ROL4__(v20, 8);
UNROLLED_LOOP_PIXEL7:
                pixel_dst[9] = render_fade_tables[texture_map[fade_lookup_index] | (tex_x_accum_high & 0xFF00)];
                v21 = tex_x_accum_combined & 0xFF0000FF;
                tex_x_accum_combined = (PAIR64(gploc_2C, texture_step_y) + PAIR64(tex_x_accum_combined, tex_x_accum_high)) >> 32;
                tex_x_accum_high += texture_step_y;
                fade_lookup_index = __ROL4__(v21, 8);
UNROLLED_LOOP_PIXEL6:
                pixel_dst[10] = render_fade_tables[texture_map[fade_lookup_index] | (tex_x_accum_high & 0xFF00)];
                v22 = tex_x_accum_combined & 0xFF0000FF;
                tex_x_accum_combined = (PAIR64(gploc_2C, texture_step_y) + PAIR64(tex_x_accum_combined, tex_x_accum_high)) >> 32;
                tex_x_accum_high += texture_step_y;
                fade_lookup_index = __ROL4__(v22, 8);
UNROLLED_LOOP_PIXEL5:
                pixel_dst[11] = render_fade_tables[texture_map[fade_lookup_index] | (tex_x_accum_high & 0xFF00)];
                v23 = tex_x_accum_combined & 0xFF0000FF;
                tex_x_accum_combined = (PAIR64(gploc_2C, texture_step_y) + PAIR64(tex_x_accum_combined, tex_x_accum_high)) >> 32;
                tex_x_accum_high += texture_step_y;
                fade_lookup_index = __ROL4__(v23, 8);
UNROLLED_LOOP_PIXEL4:
                pixel_dst[12] = render_fade_tables[texture_map[fade_lookup_index] | (tex_x_accum_high & 0xFF00)];
                v24 = tex_x_accum_combined & 0xFF0000FF;
                tex_x_accum_combined = (PAIR64(gploc_2C, texture_step_y) + PAIR64(tex_x_accum_combined, tex_x_accum_high)) >> 32;
                tex_x_accum_high += texture_step_y;
                fade_lookup_index = __ROL4__(v24, 8);
UNROLLED_LOOP_PIXEL3:
                pixel_dst[13] = render_fade_tables[texture_map[fade_lookup_index] | (tex_x_accum_high & 0xFF00)];
                v25 = tex_x_accum_combined & 0xFF0000FF;
                tex_x_accum_combined = (PAIR64(gploc_2C, texture_step_y) + PAIR64(tex_x_accum_combined, tex_x_accum_high)) >> 32;
                tex_x_accum_high += texture_step_y;
                fade_lookup_index = __ROL4__(v25, 8);
UNROLLED_LOOP_PIXEL2:
                pixel_dst[14] = render_fade_tables[texture_map[fade_lookup_index] | (tex_x_accum_high & 0xFF00)];
                v26 = tex_x_accum_combined & 0xFF0000FF;
                tex_x_accum_combined = (PAIR64(gploc_2C, texture_step_y) + PAIR64(tex_x_accum_combined, tex_x_accum_high)) >> 32;
                tex_x_accum_high += texture_step_y;
                fade_lookup_index = __ROL4__(v26, 8);
UNROLLED_LOOP_PIXEL1:
                pixel_dst[15] = render_fade_tables[texture_map[fade_lookup_index] | (tex_x_accum_high & 0xFF00)];
                v27 = tex_x_accum_combined & 0xFF0000FF;
                tex_x_accum_combined = (PAIR64(gploc_2C, texture_step_y) + PAIR64(tex_x_accum_combined, tex_x_accum_high)) >> 32;
                tex_x_accum_high += texture_step_y;
                fade_lookup_index = __ROL4__(v27, 8);
                pixel_dst += 16;
                span_too_small_or_complete = gploc_D4 <= 16;
                gploc_D4 -= 16;
                if ( span_too_small_or_complete )
                  break;
UNROLLED_LOOP_PIXEL0:
                *pixel_dst = render_fade_tables[texture_map[fade_lookup_index] | (tex_x_accum_high & 0xFF00)];
                v11 = tex_x_accum_combined & 0xFF0000FF;
                tex_x_accum_combined = (PAIR64(gploc_2C, texture_step_y) + PAIR64(tex_x_accum_combined, tex_x_accum_high)) >> 32;
                tex_x_accum_high += texture_step_y;
                fade_lookup_index = __ROL4__(v11, 8);
              }
              break;
          }
        }
        xStart = gploc_74;
        shadeAccumulator = gploc_12C + g_shadeAccumulator;
        shadeAccumulatorNext = gploc_128 + g_shadeAccumulatorNext;
        tex_x_accum_high = (PAIR64(gploc_CC, gploc_60) + PAIR64(gploc_D8, gploc_34)) >> 32;
        tex_x_accum_low = gploc_60 + gploc_34;
        tex_x_accum_combined = gploc_C4 + CFADD64(PAIR64(gploc_CC, gploc_60), PAIR64(gploc_D8, gploc_34)) + gploc_E4;
        screen_line_ptr = (uchar *)(gploc_104 + gploc_F4);
        --gploc_C0;
      }
      while ( gploc_C0 );
      goto EDGE_ADVANCE_CHECK;
    }
    while ( 1 )
    {
EDGE_ADVANCE_CHECK:
      if ( !--gploc_180 )
        return;
      g_shadeAccumulator = shadeAccumulator;
      if ( factor_chk >= 0 )
        break;
      gploc_128 = factor_cb;
      shadeAccumulatorNext = gploc_pt_shbx;
      clamped_cy2 = gploc_pt_cy;
      if ( gploc_pt_cy > LOC_vec_window_height )
        clamped_cy2 = LOC_vec_window_height;
      span_too_small_or_complete = clamped_cy2 <= gploc_pt_by;
      gploc_C0 = clamped_cy2 - gploc_pt_by;
      shadeAccumulator = g_shadeAccumulator;
      if ( span_too_small_or_complete )
        return;
      gploc_74 = xStart;
      scanline_y = gploc_pt_by;
      if ( gploc_pt_by >= 0 )
        goto REMAINDER_SCANLINE_STEP;
        
SKEWED_SCAN_ADJUST:
      while ( 1 )
      {
        carryLow32 = CFADD64(PAIR64(gploc_CC, gploc_60), PAIR64(tex_x_accum_high, tex_x_accum_low));
        tex_x_accum_high = (PAIR64(gploc_CC, gploc_60) + PAIR64(tex_x_accum_high, tex_x_accum_low)) >> 32;
        tex_x_accum_low += gploc_60;
        tex_x_accum_combined += gploc_C4 + carryLow32;
        gploc_74 -= shadeAccumulator >> 16;
        shadeAccumulatorNext += gploc_128;
        g_shadeAccumulator = gploc_12C + shadeAccumulator;
        gploc_74 += (gploc_12C + shadeAccumulator) >> 16;
        shadeAccumulator += gploc_12C;
        screen_line_ptr += gploc_104;
        if ( !--gploc_C0 )
          break;
        if ( ++scanline_y >= 0 )
        {
          goto REMAINDER_SCANLINE_STEP;
        }
      }
      xStart = gploc_74;
    }
    gploc_12C = factor_cb;
    gploc_60 = gploc_64;
    gploc_CC = gploc_98;
    gploc_C4 = gploc_94;
    tex_x_accum_low = 0;
    tex_x_accum_high = gploc_80;
    tex_x_accum_combined = gploc_7C;
    clamped_cy = gploc_pt_cy;
    if ( gploc_pt_cy > LOC_vec_window_height )
      clamped_cy = LOC_vec_window_height;
    span_too_small_or_complete = clamped_cy <= gploc_pt_by;
    gploc_C0 = clamped_cy - gploc_pt_by;
    gploc_74 = gploc_pt_bx;
    shadeAccumulator = gploc_pt_shbx;
    if ( !span_too_small_or_complete )
    {
      scanline_y = gploc_pt_by;
      if ( gploc_pt_by < 0 )
        goto SKEWED_SCAN_ADJUST;
      goto REMAINDER_SCANLINE_STEP;
    }
  }
}

/******************************************************************************/